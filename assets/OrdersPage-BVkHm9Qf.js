import{r as e,P as t,j as s,S as a,m as r,a as l,T as i,ag as n,ah as d,ai as c,aj as o,R as x,a0 as m,ak as u,al as p,am as h}from"./index-CxscT09Y.js";import{V as g,O as f}from"./index-Dg0Qh9jE.js";import{T as b}from"./TemplateRenderer-DboS4ZpZ.js";import{ar as j,T as v,K as y,A as N,a as k,as as w,at as C,au as I,av as S,aw as z,u as P,ax as A,n as T,Z as O,ay as q,C as $,az as M,aA as _,aB as D,aC as R,aD as L}from"./lucide-react-Dm8ijxDf.js";import{L as F}from"./zap-C1hV3rjf.js";import{C as E,S as W,a as U,X as V,T as B}from"./x-C-WXaDeE.js";import{a as H,H as Y,L as K,C as Q,U as Z,X as G}from"./zoom-out-BkmDqjxf.js";import{p as X}from"./parseISO-BMtrrhUZ.js";import{f as J}from"./format-DhIoevPb.js";import"./index-C08PnImj.js";import"./en-US-DXcIbJEK.js";function ee(e,t){return e===t}function te(t,s,a){var r=ee,l=e.useRef(t),i=e.useState({})[1],n=function(t,s,a,r){var l=this,i=e.useRef(null),n=e.useRef(0),d=e.useRef(0),c=e.useRef(null),o=e.useRef([]),x=e.useRef(),m=e.useRef(),u=e.useRef(t),p=e.useRef(!0);u.current=t;var h="undefined"!=typeof window,g=!s&&0!==s&&h;if("function"!=typeof t)throw new TypeError("Expected a function");s=+s||0;var f=!!(a=a||{}).leading,b=!("trailing"in a)||!!a.trailing,j="maxWait"in a,v="debounceOnServer"in a&&!!a.debounceOnServer,y=j?Math.max(+a.maxWait||0,s):null;e.useEffect(function(){return p.current=!0,function(){p.current=!1}},[]);var N=e.useMemo(function(){var e=function(e){var t=o.current,s=x.current;return o.current=x.current=null,n.current=e,d.current=d.current||e,m.current=u.current.apply(s,t)},t=function(e,t){g&&cancelAnimationFrame(c.current),c.current=g?requestAnimationFrame(e):setTimeout(e,t)},a=function(e){if(!p.current)return!1;var t=e-i.current;return!i.current||t>=s||t<0||j&&e-n.current>=y},N=function(t){return c.current=null,b&&o.current?e(t):(o.current=x.current=null,m.current)},k=function e(){var r=Date.now();if(f&&d.current===n.current&&w(),a(r))return N(r);if(p.current){var l=s-(r-i.current),c=j?Math.min(l,y-(r-n.current)):l;t(e,c)}},w=function(){r&&r({})},C=function(){if(h||v){var r=Date.now(),d=a(r);if(o.current=[].slice.call(arguments),x.current=l,i.current=r,d){if(!c.current&&p.current)return n.current=i.current,t(k,s),f?e(i.current):m.current;if(j)return t(k,s),e(i.current)}return c.current||t(k,s),m.current}};return C.cancel=function(){c.current&&(g?cancelAnimationFrame(c.current):clearTimeout(c.current)),n.current=0,o.current=i.current=x.current=c.current=null},C.isPending=function(){return!!c.current},C.flush=function(){return c.current?N(Date.now()):m.current},C},[f,j,s,y,b,g,h,v,r]);return N}(e.useCallback(function(e){l.current=e,i({})},[i]),s,a,i),d=e.useRef(t);return r(d.current,t)||(n(t),d.current=t),[l.current,n]}const se=i,ae=e=>null!=e?`${se}${e.toFixed(2)}`:`${se}0.00`,re=e=>{const t=`data:image/svg+xml;base64,${btoa('<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200"><rect width="100%" height="100%" fill="#e2e8f0"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="20" fill="#94a3b8" font-family="sans-serif">No Image</text></svg>')}`;return e&&e.data&&"string"==typeof e.data?e.data.startsWith("data:")?e.data:`data:${e.contentType};base64,${e.data}`:t},le=({product:e,onAdd:t})=>s.jsxs(r.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3,ease:"easeOut"},className:"group relative flex flex-col rounded-xl border border-slate-200 dark:border-slate-700/80 bg-white/70 dark:bg-slate-800/60 overflow-hidden transition-all duration-300 hover:shadow-cyan-500/10 hover:border-cyan-400 hover:-translate-y-1",children:[s.jsxs("div",{className:"aspect-square w-full bg-slate-100 dark:bg-slate-900/50 overflow-hidden relative",children:[s.jsx("img",{src:re(e.images?.[0]),alt:e.name,className:"w-full h-full object-cover transition-transform duration-500 ease-in-out group-hover:scale-110"}),e.periodicOffer?.isActive&&s.jsxs("div",{className:"absolute top-2 right-2 bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full flex items-center gap-1 shadow-lg",children:[s.jsx(v,{size:12})," SALE"]})]}),s.jsxs("div",{className:"p-4 flex-grow flex flex-col",children:[s.jsx("h4",{className:"font-semibold text-sm text-slate-800 dark:text-slate-100 truncate flex-grow",children:e.name}),s.jsx("p",{className:"text-slate-800 dark:text-slate-200 text-lg font-bold mt-1",children:ae(e.price)})]}),s.jsxs("button",{type:"button",onClick:()=>t(e,1),className:"w-full bg-slate-100 dark:bg-slate-900/50 text-slate-600 dark:text-slate-300 text-xs font-bold p-2.5 transition-all duration-300 hover:bg-cyan-500 hover:text-white flex items-center justify-center gap-2 group-hover:bg-cyan-500 group-hover:text-white",children:[s.jsx(y,{size:14})," Add to Cart"]})]}),ie=({service:t,onAdd:a})=>{const l={sticker:s.jsx(H,{className:"w-8 h-8"}),invitation:s.jsx(k,{className:"w-8 h-8"}),default:s.jsx(j,{className:"w-8 h-8"})},i=e.useMemo(()=>t.volumeDiscounts&&0!==t.volumeDiscounts.length?Math.max(...t.volumeDiscounts.map(e=>e.discountPercentage)):0,[t.volumeDiscounts]);return s.jsxs(r.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:"easeOut"},className:"group relative flex flex-col justify-between rounded-xl p-6 overflow-hidden transition-all duration-300 hover:shadow-purple-500/20 hover:-translate-y-1 border border-slate-200/50 dark:border-slate-700/50 bg-slate-100/50 dark:bg-slate-900/50",children:[s.jsx("div",{className:"absolute inset-0 z-0 opacity-20 dark:opacity-10 transition-opacity duration-500 group-hover:opacity-30",style:{backgroundImage:"radial-gradient(circle at 1px 1px, #a855f7 1px, transparent 0)",backgroundSize:"20px 20px"}}),s.jsxs("div",{className:"relative z-10",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsx("div",{className:"flex-shrink-0 bg-gradient-to-br from-purple-500 to-indigo-600 text-white p-3 rounded-lg shadow-lg",children:l[t.templateTypeId]||l.default}),t.periodicOffer?.isActive&&s.jsxs("div",{className:"bg-fuchsia-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full flex items-center gap-1 shadow-lg",children:[s.jsx(v,{size:12})," OFFER"]})]}),s.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white mt-4",children:t.name}),s.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 h-10",children:t.description})]}),s.jsxs("div",{className:"relative z-10 mt-4 space-y-2 text-sm",children:[s.jsxs("div",{className:"text-slate-700 dark:text-slate-300",children:["Starts from"," ",s.jsx("span",{className:"font-bold text-purple-600 dark:text-purple-400",children:ae(t.basePrice)}),s.jsx("span",{className:"text-slate-500",children:" / unit"})]}),s.jsxs("ul",{className:"text-xs space-y-1.5",children:[s.jsxs("li",{className:"flex items-center gap-2 text-slate-600 dark:text-slate-400",children:[s.jsx(E,{size:14,className:"text-green-500"}),"Premium materials & finishes available"]}),i>0&&s.jsxs("li",{className:"flex items-center gap-2 text-slate-600 dark:text-slate-400",children:[s.jsx(E,{size:14,className:"text-green-500"}),"Save up to ",i,"% on bulk orders"]})]})]}),s.jsxs("button",{type:"button",onClick:()=>a(t,50),className:"relative z-10 w-full mt-6 bg-slate-800 text-white text-sm font-semibold py-3 px-4 rounded-lg transition-all duration-300 flex items-center justify-center gap-2 shadow-lg hover:bg-purple-600 group-hover:shadow-purple-500/40",children:["Add Service to Order ",s.jsx(N,{size:16})]})]})},ne=({isLoading:i,allProducts:n,onAddProductToCart:d})=>{const[c,o]=e.useState("supplies"),x=e.useMemo(()=>n.filter(e=>"physical_good"===e.productType),[n]),m=e.useMemo(()=>n.filter(e=>"template_service"===e.productType),[n]),u=[{id:"supplies",label:"Accessories & Supplies",icon:t,count:x.length},{id:"services",label:"Custom Prints",icon:j,count:m.length}];return s.jsxs("div",{className:"relative p-6 rounded-2xl shadow-xl transition-all duration-300 backdrop-blur-lg bg-white/60 border border-slate-200/70 dark:bg-slate-800/50 dark:border-white/10",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white flex items-center gap-3",children:[s.jsx(a,{className:"text-cyan-500"}),"Store & Services"]}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Purchase supplies or add a custom printing service to your order."})]}),s.jsx("div",{className:"relative flex-shrink-0 p-1 rounded-full shadow-inner backdrop-blur-md bg-slate-200/60 dark:bg-slate-800/40 border border-white/10 flex space-x-1",children:u.map(e=>{const t=c===e.id;return s.jsxs("button",{onClick:()=>o(e.id),className:`\n          relative flex items-center gap-2 px-4 py-1.5 rounded-full text-sm font-semibold\n          transition-all duration-300 ease-out\n          ${t?"text-white":"text-slate-600 dark:text-slate-300 hover:bg-white/30 dark:hover:bg-white/10"}\n        `,children:[t&&s.jsx(r.div,{layoutId:"filter-active-bg",className:"absolute inset-0 z-0 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 shadow-lg shadow-cyan-500/30",transition:{type:"spring",stiffness:500,damping:30}}),s.jsxs("span",{className:"relative z-10 flex items-center gap-1",children:[s.jsx(e.icon,{size:16,className:"opacity-80"}),e.label]})]},e.id)})})]}),i?s.jsx("div",{className:"flex justify-center py-20",children:s.jsx(F,{className:"animate-spin text-cyan-500",size:40})}):s.jsxs(l,{mode:"wait",children:["supplies"===c&&s.jsx(r.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},children:x.length>0?s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:x.map(e=>s.jsx(le,{product:e,onAdd:d},e._id))}):s.jsxs("div",{className:"text-center py-16 text-slate-500",children:[s.jsx(t,{size:48,className:"mx-auto"}),s.jsx("p",{className:"mt-4 font-semibold",children:"No Supplies Available"}),s.jsx("p",{className:"text-sm",children:"Check back later for high-quality accessories."})]})},"supplies"),"services"===c&&s.jsx(r.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},children:m.length>0?s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:m.map(e=>s.jsx(ie,{service:e,onAdd:d},e._id))}):s.jsxs("div",{className:"text-center py-16 text-slate-500",children:[s.jsx(j,{size:48,className:"mx-auto"}),s.jsx("p",{className:"mt-4 font-semibold",children:"No Printing Services Available"}),s.jsx("p",{className:"text-sm",children:"Please check back later for custom print options."})]})},"services")]})]})},de=i,ce=e=>null!=e?`${de}${e.toFixed(2)}`:`${de}0.00`,oe="relative p-6 rounded-2xl shadow-xl transition-all duration-300 backdrop-blur-lg bg-white/60 border border-slate-200/70 dark:bg-slate-800/50 dark:border-white/10",xe="block w-full px-4 py-2.5 text-sm text-slate-700 dark:text-slate-200 bg-slate-50 dark:bg-slate-900/50 border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-all duration-200",me=e=>s.jsx("input",{...e,className:xe}),ue=e=>s.jsx("select",{...e,className:xe}),pe=e=>s.jsx("textarea",{...e,rows:"3",className:xe}),he=e=>{const t=`data:image/svg+xml;base64,${btoa('<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200"><rect width="100%" height="100%" fill="#e2e8f0"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="20" fill="#94a3b8" font-family="sans-serif">No Image</text></svg>')}`;if(!e||!e.data)return t;if("object"==typeof e.data&&"Buffer"===e.data.type&&Array.isArray(e.data.data))try{const t=String.fromCharCode.apply(null,e.data.data),s=btoa(t);return`data:${e.contentType};base64,${s}`}catch(s){return t}return"string"==typeof e.data&&e.data.startsWith("data:")?e.data:"string"==typeof e.data?`data:${e.contentType};base64,${e.data}`:t},ge=x.memo(({template:e,templateSize:t,pageIndex:a=0,side:r="front",containerWidth:l,containerHeight:i,className:n=""})=>{if(!(e&&t&&l&&i&&0!==l))return s.jsx("div",{className:`w-full h-full flex items-center justify-center bg-slate-200 dark:bg-slate-800 ${n}`});const d=e.design?.pages?.[a];if(!d)return null;const c=d[r]||d.front;if(!c)return null;const o=t.width>=t.height?"horizontal":"vertical",x=c.layouts?.[o]?.elements||[],m=Math.min(l/t.width,i/t.height),u={width:m*t.width+"px",height:m*t.height+"px",position:"relative",overflow:"hidden"},p={position:"absolute",top:0,left:0,transform:`scale(${m})`,transformOrigin:"top left"};return s.jsx("div",{style:u,className:n,children:s.jsx("div",{style:p,children:s.jsx(b,{elements:x,pageSide:c,width:t.width,height:t.height,theme:"light"})})})}),fe=({template:t,sizePresets:a,containerClassName:i})=>{const n=t?.design?.pages||[],[d,c]=e.useState(0),[o,x]=(()=>{const[t,s]=e.useState({width:0,height:0}),a=e.useRef(null);return e.useEffect(()=>{const e=a.current;if(!e)return;const t=new ResizeObserver(e=>{if(e[0]){const{width:t,height:a}=e[0].contentRect;s({width:t,height:a})}});return t.observe(e),()=>{e&&t.unobserve(e)}},[]),[a,t]})(),m=e.useMemo(()=>a&&0!==a.length&&t&&(a.find(e=>e.id===t.defaultSizePreset)||a.find(e=>"custom"===e.id))||{width:800,height:600},[t,a]);return e.useEffect(()=>{if(n.length<=1)return;const e=setInterval(()=>c(e=>(e+1)%n.length),2500);return()=>clearInterval(e)},[n.length]),s.jsx("div",{ref:o,className:`w-full h-full relative flex items-center justify-center overflow-hidden ${i}`,children:s.jsx(l,{initial:!1,children:s.jsx(r.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:-30},transition:{duration:.5,ease:"easeInOut"},className:"absolute",children:x.width>0&&s.jsx(ge,{template:t,templateSize:m,pageIndex:d,containerWidth:x.width,containerHeight:x.height,className:"shadow-lg rounded-md"})},d)})})},be=x.memo(({files:e,onFilesChange:t,uniqueId:a})=>s.jsxs("div",{children:[s.jsxs("label",{htmlFor:a,className:"relative cursor-pointer flex items-center justify-center w-full h-24 border-2 border-slate-300 dark:border-slate-600 border-dashed rounded-lg bg-slate-50 dark:bg-slate-900/50 hover:bg-slate-100 dark:hover:bg-slate-800/60 transition-colors",children:[s.jsxs("div",{className:"text-center",children:[s.jsx(Z,{className:"mx-auto h-8 w-8 text-slate-400"}),s.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:s.jsx("span",{className:"font-semibold text-cyan-600 dark:text-cyan-400",children:"Add files"})})]}),s.jsx("input",{id:a,name:a,type:"file",multiple:!0,className:"sr-only",onChange:s=>t([...e,...Array.from(s.target.files)])})]}),s.jsx("div",{className:"mt-2 grid grid-cols-2 gap-2",children:e.map(a=>s.jsxs("div",{className:"flex items-center justify-between text-xs p-1.5 bg-slate-100 dark:bg-slate-700/50 rounded",children:[s.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[s.jsx(H,{size:16,className:"text-slate-500 flex-shrink-0"}),s.jsx("p",{className:"font-medium truncate",children:a.name})]}),s.jsx("button",{type:"button",onClick:()=>{return s=a.name,t(e.filter(e=>e.name!==s));var s},className:"p-0.5 rounded-full hover:bg-red-500/20 text-red-500",children:s.jsx(V,{size:12})})]},a.name))})]})),je=x.memo(({template:e,onAddToCart:t,sizePresets:a})=>s.jsxs("div",{className:"relative group",title:"pending"===e.paymentStatus?"Payment for this template is pending":`Add ${e.name} to order`,children:[s.jsxs("button",{type:"button",onClick:()=>t(e),disabled:"pending"===e.paymentStatus,className:"w-full text-left border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden transition-all transform disabled:opacity-50 disabled:cursor-not-allowed group-hover:shadow-lg group-hover:border-cyan-500 group-hover:-translate-y-1 disabled:transform-none disabled:hover:shadow-none",children:[s.jsx("div",{className:"h-40 bg-slate-100 dark:bg-slate-900/50 flex items-center justify-center",children:s.jsx(fe,{template:e,sizePresets:a,containerClassName:"p-2"})}),s.jsx("div",{className:"p-2 border-t border-slate-200 dark:border-slate-700",children:s.jsx("p",{className:"text-xs font-semibold truncate text-slate-700 dark:text-slate-200",children:e.name})})]}),"pending"===e.paymentStatus&&s.jsxs("div",{className:"absolute inset-0 bg-black/60 flex flex-col items-center justify-center p-2 text-center rounded-lg pointer-events-none",children:[s.jsx(K,{className:"text-amber-400 w-6 h-6 mb-1"}),s.jsx("p",{className:"text-xs font-bold text-white",children:"Payment Pending"})]})]})),ve=x.memo(({item:a,onUpdate:l,onRemove:i,template:n,sizePresets:d})=>{const c=e.useMemo(()=>he(a.productImage),[a.productImage]),o=e.useMemo(()=>"product"===a.itemType?s.jsx(t,{className:"w-5 h-5 text-cyan-500"}):s.jsx(j,{className:"w-5 h-5 text-purple-500"}),[a.itemType]);return s.jsx(r.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,height:0,margin:0,padding:0},transition:{duration:.3,ease:"easeInOut"},className:"bg-white/50 dark:bg-slate-800/40 border border-slate-200 dark:border-slate-700 rounded-2xl overflow-hidden shadow-sm",children:s.jsxs("div",{className:"p-4 grid grid-cols-1 md:grid-cols-3 gap-x-6 gap-y-4",children:[s.jsxs("div",{className:"md:col-span-1 flex items-center gap-4",children:[s.jsx("div",{className:"w-20 h-20 bg-slate-100 dark:bg-slate-900/50 rounded-lg flex items-center justify-center flex-shrink-0",children:"template_service"===a.itemType&&n?s.jsx(fe,{template:n,sizePresets:d}):s.jsx("img",{src:c,alt:a.productName||"",className:"w-full h-full object-cover rounded-md"})}),s.jsxs("div",{className:"flex-grow",children:[s.jsx("h4",{className:"font-bold text-slate-800 dark:text-white leading-tight",children:a.productName||a.templateName}),s.jsxs("div",{className:"flex items-center gap-1.5 mt-1 text-xs text-slate-500 dark:text-slate-400 capitalize",children:[o,s.jsx("span",{children:"product"===a.itemType?`SKU: ${a.productSku}`:a.templateTypeId?.replace("-"," ")})]})]})]}),s.jsxs("div",{className:"md:col-span-1 flex flex-col justify-center gap-4",children:["template_service"===a.itemType?s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("label",{className:"text-xs font-medium text-slate-600 dark:text-slate-300 w-16 flex items-center gap-1.5",children:[s.jsx(A,{size:14})," Material"]}),s.jsxs(ue,{className:"!py-1.5",value:a.material,onChange:e=>l(a.cartId,"material",e.target.value),children:[s.jsx("option",{value:"standard",children:"Standard"}),s.jsx("option",{value:"premium",children:"Premium"})]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("label",{className:"text-xs font-medium text-slate-600 dark:text-slate-300 w-16 flex items-center gap-1.5",children:[s.jsx(T,{size:14})," Finish"]}),s.jsxs(ue,{className:"!py-1.5",value:a.finish,onChange:e=>l(a.cartId,"finish",e.target.value),children:[s.jsx("option",{value:"matte",children:"Matte"}),s.jsx("option",{value:"glossy",children:"Glossy"})]})]})]}):s.jsx("div",{className:"h-full flex items-center",children:s.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Update quantity as needed."})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("label",{className:"text-xs font-medium text-slate-600 dark:text-slate-300 w-16",children:"Quantity"}),s.jsxs("div",{className:"flex items-center gap-2 w-full max-w-[150px]",children:[s.jsx("button",{type:"button",onClick:()=>l(a.cartId,"quantity",Math.max(1,a.quantity-1)),className:"p-2 rounded-md bg-slate-200 dark:bg-slate-700/80 hover:bg-slate-300 dark:hover:bg-slate-700 transition",children:s.jsx(O,{size:14})}),s.jsx(me,{type:"number",min:"1",className:"text-center !py-1.5",value:a.quantity,onChange:e=>l(a.cartId,"quantity",parseInt(e.target.value,10)||1)}),s.jsx("button",{type:"button",onClick:()=>l(a.cartId,"quantity",a.quantity+1),className:"p-2 rounded-md bg-slate-200 dark:bg-slate-700/80 hover:bg-slate-300 dark:hover:bg-slate-700 transition",children:s.jsx(y,{size:14})})]})]})]}),s.jsxs("div",{className:"md:col-span-1 flex flex-col items-end justify-center text-right",children:[s.jsx("button",{type:"button",onClick:i,className:"absolute top-2 right-2 p-1.5 rounded-full text-slate-400 hover:bg-red-500/10 hover:text-red-500",children:s.jsx(V,{size:16})}),s.jsx("p",{className:"font-bold text-xl text-slate-800 dark:text-white",children:ce(a.finalPrice*a.quantity-a.discountApplied)}),a.discountApplied>0&&s.jsx("p",{className:"text-sm text-slate-500 line-through",children:ce(a.finalPrice*a.quantity)}),s.jsx("div",{className:"flex-grow"}),a.discountApplied>0&&s.jsxs("div",{className:"mt-2 p-1.5 px-2.5 bg-green-100 dark:bg-green-900/50 rounded-md text-xs font-semibold text-green-700 dark:text-green-300 flex items-center gap-2",children:[s.jsx(v,{size:12}),s.jsxs("span",{children:[a.discountReason,": -",ce(a.discountApplied)]})]})]}),"template_service"===a.itemType&&s.jsxs("div",{className:"md:col-span-3 pt-4 border-t border-slate-200/80 dark:border-slate-700/80",children:[s.jsxs("label",{className:"text-xs font-medium text-slate-600 dark:text-slate-300 flex items-center gap-2 mb-2",children:[s.jsx(m,{size:14})," Additional Files & Customization"]}),s.jsx(be,{files:a.additionalFiles,onFilesChange:e=>l(a.cartId,"additionalFiles",e),uniqueId:`file-${a.cartId}`})]})]})})}),ye=x.memo(({templateItem:t,onAddProduct:i})=>{const[n,d]=e.useState({data:null,isLoading:!0}),c=e.useRef(null),[o,x]=e.useState({left:!1,right:!1}),m=e.useCallback(()=>{const e=c.current;if(e){const t=e.scrollWidth>e.clientWidth;x({left:t&&e.scrollLeft>5,right:t&&e.scrollLeft<e.scrollWidth-e.clientWidth-5})}},[]);e.useEffect(()=>{t&&(d({data:null,isLoading:!0}),p(t.templateTypeId).then(e=>{d({data:e,isLoading:!1}),setTimeout(m,100)}).catch(()=>d({data:null,isLoading:!1})))},[t,m]),e.useEffect(()=>{const e=c.current;if(e)return e.addEventListener("scroll",m),window.addEventListener("resize",m),()=>{e.removeEventListener("scroll",m),window.removeEventListener("resize",m)}},[m,n.data]);const u=e=>{const t=c.current;t&&t.scrollBy({left:"left"===e?.8*-t.clientWidth:.8*t.clientWidth,behavior:"smooth"})};return s.jsx(l,{children:t&&s.jsxs(r.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:`${oe} relative`,children:[s.jsxs("h3",{className:"font-semibold text-lg text-slate-800 dark:text-white mb-4 flex items-center gap-2",children:[s.jsx(a,{size:20,className:"text-amber-500"})," Suggested Add-ons for"," ",t.templateName]}),n.isLoading?s.jsx("div",{className:"h-48 flex items-center justify-center",children:s.jsx(F,{className:"animate-spin"})}):n.data?.suggestedProducts?.length>0?s.jsxs("div",{className:"relative",children:[s.jsx(l,{children:o.left&&s.jsx("button",{onClick:()=>u("left"),className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-white/80 dark:bg-slate-900/80 shadow-lg border border-slate-200 dark:border-slate-700 hover:scale-110 transition-transform -translate-x-1/2",children:s.jsx(P,{size:20})})}),s.jsx("div",{ref:c,className:"flex gap-4 overflow-x-auto pb-2 -mb-2 snap-x snap-mandatory scroll-smooth",style:{scrollbarWidth:"none","-ms-overflow-style":"none"},children:n.data.suggestedProducts.map(e=>{const t=he(e.images?.[0]);return s.jsxs("div",{className:"flex-shrink-0 w-48 snap-start bg-white/80 dark:bg-slate-900/50 rounded-lg border border-slate-200 dark:border-slate-700 overflow-hidden group transition-all hover:shadow-lg hover:-translate-y-0.5",children:[s.jsx("div",{className:"h-24 w-full overflow-hidden",children:s.jsx("img",{src:t,alt:e.name,className:"h-full w-full object-cover transition-transform group-hover:scale-105"})}),s.jsxs("div",{className:"p-3",children:[s.jsx("p",{className:"font-semibold text-sm truncate",children:e.name}),s.jsx("p",{className:"text-sm font-bold text-slate-700 dark:text-slate-200",children:ce(e.price)})]}),s.jsxs("button",{type:"button",onClick:()=>i(e,1),className:"w-full bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 text-xs font-bold p-2 transition hover:bg-cyan-500 hover:text-white flex items-center justify-center gap-2",children:[s.jsx(y,{size:14})," Add"]})]},e._id)})}),s.jsx(l,{children:o.right&&s.jsx("button",{onClick:()=>u("right"),className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 p-2 rounded-full bg-white/80 dark:bg-slate-900/80 shadow-lg border border-slate-200 dark:border-slate-700 hover:scale-110 transition-transform translate-x-1/2",children:s.jsx(U,{size:20})})})]}):s.jsx("p",{className:"text-center text-sm text-slate-500 py-4 h-48 flex items-center justify-center",children:"No suggested add-ons for this item."})]})})}),Ne=x.memo(({currentPage:e,totalPages:t,onPageChange:a})=>{if(t<=1)return null;const r=[];for(let s=1;s<=t;s++)r.push(s);return s.jsx("nav",{className:"flex justify-center items-center gap-2 mt-8",children:r.map(t=>s.jsx("button",{onClick:()=>a(t),className:"px-3.5 py-1.5 text-sm font-semibold rounded-lg transition-colors "+(e===t?"bg-cyan-500 text-white shadow":"bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700"),children:t},t))})}),ke=x.memo(({products:t,onAddProduct:a,onAddService:i})=>{const[n,d]=e.useState("accessories"),[c,o]=e.useState(1),{filteredItems:x,totalPages:m}=e.useMemo(()=>{const e=t.filter(e=>"accessories"===n&&"physical_good"===e.productType||"services"===n&&"template_service"===e.productType);return{filteredItems:e,totalPages:Math.ceil(e.length/4)}},[t,n]),u=e.useMemo(()=>{const e=4*(c-1);return x.slice(e,e+4)},[c,x]),p=({item:e})=>{const t="template_service"===e.productType,l=he(e.images?.[0]);return s.jsxs(r.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"group relative flex flex-col bg-white/70 dark:bg-slate-800/50 p-3 rounded-xl border border-slate-200/80 dark:border-slate-700/60 transition-shadow hover:shadow-lg",children:[s.jsx("div",{className:"w-full h-24 rounded-lg bg-slate-100 dark:bg-slate-900 flex-shrink-0 overflow-hidden mb-3",children:s.jsx("img",{src:l,alt:e.name,className:"w-full h-full object-cover transition-transform group-hover:scale-105"})}),s.jsx("p",{className:"font-semibold text-sm truncate flex-grow",children:e.name}),s.jsxs("div",{className:"flex justify-between items-center mt-2",children:[s.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-200",children:t?`From ${ce(e.basePrice)}`:ce(e.price)}),s.jsx("button",{onClick:()=>{t?i(e,50):a(e,1)},className:"p-2 rounded-full bg-cyan-100 text-cyan-600 dark:bg-cyan-900/50 dark:text-cyan-400 hover:bg-cyan-200 dark:hover:bg-cyan-900/80 transition-transform hover:scale-110",children:s.jsx(y,{size:16})})]})]})},h=e=>{d(e),o(1)};return 0===t.length?null:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("h3",{className:"font-semibold text-lg text-slate-800 dark:text-white flex items-center gap-2",children:[s.jsx(q,{size:20,className:"text-cyan-500"})," Discover"]}),s.jsxs("div",{className:"flex space-x-1 p-0.5 bg-slate-200 dark:bg-slate-900/50 rounded-full",children:[s.jsx("button",{onClick:()=>h("accessories"),className:"px-2.5 py-1 text-xs font-semibold rounded-full transition-colors "+("accessories"===n?"bg-cyan-500 text-white":"text-slate-600 dark:text-slate-300"),children:"Accessories"}),s.jsx("button",{onClick:()=>h("services"),className:"px-2.5 py-1 text-xs font-semibold rounded-full transition-colors "+("services"===n?"bg-purple-500 text-white":"text-slate-600 dark:text-slate-300"),children:"Services"})]})]}),s.jsx("div",{className:"relative min-h-[290px]",children:s.jsx(l,{mode:"wait",children:s.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:u.length>0?s.jsx("div",{className:"grid grid-cols-2 gap-3",children:u.map(e=>s.jsx(p,{item:e},e._id))}):s.jsx("p",{className:"text-center text-sm text-slate-500 pt-16",children:"No items found."})},n+c)})}),m>1&&s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("button",{onClick:()=>o(e=>Math.max(1,e-1)),disabled:1===c,className:"p-2 rounded-full disabled:opacity-50 transition bg-slate-200 dark:bg-slate-700/80",children:s.jsx(P,{size:16})}),s.jsxs("span",{className:"text-xs font-semibold text-slate-500",children:["Page ",c," of ",m]}),s.jsx("button",{onClick:()=>o(e=>Math.min(m,e+1)),disabled:c===m,className:"p-2 rounded-full disabled:opacity-50 transition bg-slate-200 dark:bg-slate-700/80",children:s.jsx(U,{size:16})})]})]})}),we=({status:e})=>{const t={processing:{i:M,t:"Processing",c:"bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-300"},printing:{i:j,t:"Printing",c:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/50 dark:text-indigo-400"},shipped:{i:z,t:"Shipped",c:"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-400"},delivered:{i:$,t:"Delivered",c:"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300"},cancelled:{i:G,t:"Cancelled",c:"bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-400"}},a=t[e]||t.processing,r=a.i;return s.jsxs("div",{className:`flex items-center gap-2 text-xs font-bold px-3 py-1.5 rounded-full capitalize ${a.c}`,children:[s.jsx(r,{size:16}),s.jsx("span",{children:a.t})]})},Ce=({orderId:a})=>{const[r,l]=e.useState(null),[i,n]=e.useState(!0);e.useEffect(()=>{let e=!0;return n(!0),h(a).then(t=>{e&&l(t)}).catch(()=>g.error("Could not fetch order details.")).finally(()=>{e&&n(!1)}),()=>{e=!1}},[a]);const d=e.useMemo(()=>r?.shipmentInfo?.shippingLabelImage?he(r.shipmentInfo.shippingLabelImage):null,[r]),c=e.useMemo(()=>r?.shipmentInfo?.packedOrderImage?he(r.shipmentInfo.packedOrderImage):null,[r]);return i?s.jsx("div",{className:"p-6 flex justify-center items-center h-48",children:s.jsx(F,{className:"animate-spin text-cyan-500"})}):r?s.jsx("div",{className:"p-4 sm:p-6 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-8 mt-8",children:[s.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[s.jsxs("div",{children:[s.jsxs("h4",{className:"flex items-center gap-2 font-bold mb-3 text-slate-800 dark:text-slate-100",children:[s.jsx(t,{size:18})," Items"]}),s.jsx("div",{className:"space-y-2",children:r.items.map(e=>s.jsxs("div",{className:"flex justify-between p-2.5 bg-slate-100/70 dark:bg-slate-900/40 rounded-lg text-sm",children:[s.jsx("span",{className:"font-medium text-slate-700 dark:text-slate-200",children:e.nameSnapshot}),s.jsxs("span",{className:"text-slate-500 dark:text-slate-400",children:["Qty: ",e.quantity]})]},e._id))})]}),s.jsxs("div",{children:[s.jsxs("h4",{className:"flex items-center gap-2 font-bold mb-3 text-slate-800 dark:text-slate-100",children:[s.jsx(_,{size:18})," Shipping To"]}),s.jsxs("address",{className:"not-italic text-sm text-slate-600 dark:text-slate-300 leading-relaxed bg-slate-100/70 dark:bg-slate-900/40 p-4 rounded-lg",children:[s.jsx("span",{className:"font-semibold",children:r.shippingAddress.fullName}),s.jsx("br",{}),r.shippingAddress.addressLine1,s.jsx("br",{}),r.shippingAddress.city,", ",r.shippingAddress.state," ",r.shippingAddress.zipCode]})]})]}),r.shipmentInfo&&s.jsxs("div",{className:"lg:col-span-2 bg-slate-100/70 dark:bg-white/5 p-6 rounded-2xl border border-slate-200 dark:border-slate-700/40 shadow-sm",children:[s.jsxs("h4",{className:"flex items-center gap-2 text-lg font-semibold text-slate-800 dark:text-white mb-6",children:[s.jsx(z,{size:20,className:"text-cyan-500"}),"Shipment Details"]}),d&&c&&s.jsx("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[d,c].map((e,t)=>s.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"group relative overflow-hidden rounded-lg border border-slate-300/40 dark:border-slate-700/60 bg-white/60 dark:bg-slate-800/30 shadow-sm hover:shadow-md transition-shadow",children:s.jsx("img",{src:e,alt:0===t?"Shipping Label":"Packed Order",className:"w-full max-h-48 object-cover rounded-lg transition-transform duration-300 group-hover:scale-105"})},t))}),s.jsxs("ul",{className:"space-y-5 text-sm",children:[s.jsxs("li",{className:"flex items-start gap-3",children:[s.jsx(D,{size:16,className:"mt-0.5 text-cyan-500 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs uppercase tracking-wide font-medium text-slate-500 dark:text-slate-400 mb-0.5",children:"Shipped On"}),s.jsx("p",{className:"text-slate-800 dark:text-slate-100 font-semibold",children:J(X(r.shipmentInfo.shippedAt),"PPP")})]})]}),s.jsxs("li",{className:"flex items-start gap-3",children:[s.jsx(t,{size:16,className:"mt-0.5 text-cyan-500 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-xs uppercase tracking-wide font-medium text-slate-500 dark:text-slate-400 mb-0.5",children:"Carrier"}),s.jsx("p",{className:"text-slate-800 dark:text-slate-100 font-semibold",children:r.shipmentInfo.carrier})]})]}),s.jsxs("li",{className:"flex items-start gap-3",children:[s.jsx(R,{size:16,className:"mt-0.5 text-cyan-500 flex-shrink-0"}),s.jsxs("div",{className:"w-full",children:[s.jsx("p",{className:"text-xs uppercase tracking-wide font-medium text-slate-500 dark:text-slate-400 mb-1",children:"Tracking Number"}),s.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(r.shipmentInfo.trackingNumber),g.success("Tracking number copied!")},className:"group flex items-center justify-between w-full px-3 py-2 bg-slate-200/70 dark:bg-slate-800/50 border border-slate-300/50 dark:border-slate-600/40 rounded-md font-mono text-sm text-cyan-600 dark:text-cyan-400 hover:bg-cyan-100/60 dark:hover:bg-cyan-900/30 transition-colors",children:[s.jsx("span",{className:"break-all",children:r.shipmentInfo.trackingNumber}),s.jsx(L,{size:14,className:"text-slate-400 group-hover:text-cyan-500 transition-colors ml-2"})]})]})]})]})]})]})}):null},Ie=({order:e,onSelect:a,isSelected:i})=>s.jsxs("div",{className:"rounded-xl bg-white dark:bg-slate-800 shadow-md transition-all border "+(i?"border-cyan-500 shadow-cyan-500/10":"border-slate-200 dark:border-slate-700 hover:shadow-lg hover:-translate-y-0.5"),children:[s.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 p-4 cursor-pointer",onClick:a,children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"p-3 bg-cyan-100 dark:bg-cyan-900/50 rounded-lg text-cyan-600 dark:text-cyan-400",children:s.jsx(t,{size:24})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-bold text-slate-800 dark:text-white",children:e.orderId}),s.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:[e.itemsCount," items â€¢ Placed on ",J(X(e.createdAt),"PP")]})]})]}),s.jsxs("div",{className:"flex items-center gap-4 sm:gap-6",children:[s.jsx("p",{className:"font-bold text-lg text-slate-900 dark:text-white",children:ce(e.totalAmount)}),s.jsx(we,{status:e.status}),s.jsx(r.div,{animate:{rotate:i?90:0},children:s.jsx(U,{size:20,className:"text-slate-400"})})]})]}),s.jsx(l,{children:i&&s.jsx(r.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3,ease:"easeInOut"},className:"overflow-hidden",children:s.jsx(Ce,{orderId:e._id})})})]}),Se=({isOpen:e,onClose:t,cartItems:a,onUpdate:i,onRemove:n,orderSummary:d,onViewOrder:c})=>s.jsx(l,{children:e&&s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[s.jsx(r.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:t}),s.jsxs(r.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:25},className:"relative w-full max-w-lg bg-slate-100 dark:bg-slate-900 rounded-2xl shadow-2xl flex flex-col max-h-[80vh]",children:[s.jsxs("header",{className:"p-4 flex justify-between items-center border-b border-slate-200 dark:border-slate-700 flex-shrink-0",children:[s.jsxs("h2",{className:"font-bold text-xl flex items-center gap-2",children:[s.jsx(w,{})," Your Cart Preview"]}),s.jsx("button",{type:"button",onClick:t,className:"p-1 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700",children:s.jsx(V,{})})]}),a.length>0?s.jsxs("div",{className:"flex flex-col flex-grow",children:[s.jsx("div",{className:"p-6 space-y-4 overflow-y-auto flex-grow",children:a.map(e=>{const t=he(e.productImage);return s.jsxs("div",{className:"flex gap-4 items-start",children:[s.jsx("div",{className:"w-16 h-16 bg-slate-200 dark:bg-slate-800 rounded-lg flex items-center justify-center flex-shrink-0",children:"product"===e.itemType?s.jsx("img",{src:t,alt:e.productName,className:"w-full h-full object-cover rounded-md"}):s.jsx(j,{})}),s.jsxs("div",{className:"flex-grow",children:[s.jsx("p",{className:"font-semibold text-sm",children:e.productName||e.templateName}),s.jsx("p",{className:"text-sm font-bold",children:ce(e.finalPrice||e.price)}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx("button",{type:"button",onClick:()=>i(e.cartId,"quantity",Math.max(1,e.quantity-1)),className:"p-1 rounded-md bg-slate-200 dark:bg-slate-700",children:s.jsx(O,{size:12})}),s.jsx("span",{className:"text-sm font-semibold w-6 text-center",children:e.quantity}),s.jsx("button",{type:"button",onClick:()=>i(e.cartId,"quantity",e.quantity+1),className:"p-1 rounded-md bg-slate-200 dark:bg-slate-700",children:s.jsx(y,{size:12})})]})]}),s.jsx("button",{type:"button",onClick:()=>n(e.cartId),className:"p-1 text-slate-400 hover:text-red-500",children:s.jsx(B,{size:16})})]},e.cartId)})}),s.jsxs("footer",{className:"p-6 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 space-y-3 flex-shrink-0",children:[s.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[s.jsx("span",{children:"Est. Total"}),s.jsx("span",{children:ce(d.totalAmount)})]}),s.jsx("button",{type:"button",onClick:c,className:"w-full btn-primary !py-3",children:"View Full Order & Checkout"})]})]}):s.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500",children:[s.jsx(w,{size:64}),s.jsx("p",{className:"mt-4 font-semibold",children:"Your cart is empty"})]})]})]})}),ze=({title:e,icon:t,orders:a,selectedOrderId:i,onSelectOrder:n,count:d,isOpen:c,onToggle:o})=>s.jsxs("div",{className:"border border-slate-200 dark:border-slate-700 rounded-2xl overflow-hidden",children:[s.jsxs("button",{onClick:o,className:"w-full flex justify-between items-center p-4 bg-slate-100/50 dark:bg-slate-800/50 hover:bg-slate-200/50 dark:hover:bg-slate-700/50 transition-colors",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[t,s.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white",children:e}),d>0&&s.jsx("span",{className:"text-xs font-bold px-2 py-0.5 rounded-full bg-cyan-100 text-cyan-700 dark:bg-cyan-900/50 dark:text-cyan-400",children:d})]}),s.jsx(r.div,{animate:{rotate:c?180:0},children:s.jsx(Q,{size:20})})]}),s.jsx(l,{initial:!1,children:c&&s.jsx(r.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{opacity:1,height:"auto"},collapsed:{opacity:0,height:0}},transition:{duration:.4,ease:[.04,.62,.23,.98]},className:"overflow-hidden",children:s.jsx("div",{className:"p-4 space-y-4",children:a.length>0?a.map(e=>s.jsx(Ie,{order:e,isSelected:i===e._id,onSelect:()=>n(e._id)},e._id)):s.jsx("p",{className:"text-center text-sm text-slate-500 py-8",children:"No orders in this section."})})})})]});function Pe(){const[a,i]=e.useState("new_order"),[x,p]=e.useState({page:!0,templates:!1,orders:!1}),[h,b]=e.useState(!1),[j,v]=e.useState([]),[N,k]=e.useState([]),[P,A]=e.useState([]),[T,O]=e.useState([]),[q,$]=e.useState([]),[M,_]=e.useState({fullName:"",addressLine1:"",city:"",state:"",zipCode:"",country:"India"}),[D,R]=e.useState(""),[L,E]=e.useState(!1),[U,V]=e.useState(""),[B]=te(U,500),[H,K]=e.useState(1),[Q,Z]=e.useState(null),[G,X]=e.useState(null),[J,ee]=e.useState(!1),[se,ae]=e.useState(["active"]),re=e.useRef(null),le=e.useMemo(()=>j.filter(e=>!["delivered","cancelled"].includes(e.status)),[j]),ie=e.useMemo(()=>j.filter(e=>["delivered","cancelled"].includes(e.status)),[j]),de=e.useMemo(()=>new Map(P.map(e=>[e._id.toString(),e])),[P]),xe=e.useMemo(()=>new Map(N.map(e=>[e.id,e])),[N]),ue=e.useMemo(()=>{const e=8*(H-1);return N.slice(e,e+8)},[H,N]),he=e.useMemo(()=>Math.ceil(N.length/8),[N]),ge=e.useMemo(()=>{let e=0,t=0;const s=new Date,a=q.map(a=>{const r=de.get(a.productId);if(!r)return{...a,finalPrice:0,discountApplied:0,discountReason:""};let l=r.price||r.basePrice||0,i=l;if("template_service"===a.itemType){i=l*(r.materialModifiers?.[a.material]||1)*(r.finishModifiers?.[a.finish]||1)}const n=i*a.quantity;e+=n;let d=0,c="";if(r.volumeDiscounts?.length>0){const e=[...r.volumeDiscounts].sort((e,t)=>t.quantityThreshold-e.quantityThreshold).find(e=>a.quantity>=e.quantityThreshold);e&&(d=n*(e.discountPercentage/100),c=`Volume Discount (${e.discountPercentage}%)`)}if(!d&&r.periodicOffer?.isActive){const{startDate:e,endDate:t}=r.periodicOffer;new Date(e)<=s&&new Date(t)>=s&&(d=n*(r.periodicOffer.discountPercentage/100),c=r.periodicOffer.offerName)}return t+=d,{...a,finalPrice:i,basePrice:i,discountApplied:d,discountReason:c}}),r=e-t,l=r>2e3||r<=0?0:50;return{subtotal:e,totalDiscount:t,shipping:l,totalAmount:r+l,updatedCartItems:a}},[q,de]),fe=e.useCallback(async()=>{p(e=>({...e,page:!0}));try{await Promise.all([n().then(e=>A(e||[])),d().then(e=>O(e||[])),c().then(e=>v(e||[]))]),b(!0)}catch(e){g.error("Failed to load initial page data.")}finally{p(e=>({...e,page:!1}))}},[]),be=e.useCallback(async()=>{p(e=>({...e,templates:!0}));try{const e=await o({page:1,limit:1e3,searchTerm:B});k(e.templates||[]),K(1)}catch(e){g.error("Could not fetch your templates.")}finally{p(e=>({...e,templates:!1}))}},[B]);e.useEffect(()=>{h||fe()},[h,fe]),e.useEffect(()=>{h&&be()},[B,h,be]);const we=e.useCallback(e=>{i(e)},[]),Ce=e.useCallback(e=>{if("pending"===e.paymentStatus)return void g.error("Payment for this template is pending.");if(q.some(t=>"template_service"===t.itemType&&t.templateId===e.id))return void g.error(`${e.name} is already in the order.`);const t=P.find(t=>"template_service"===t.productType&&t.templateTypeId===e.type);if(!t)return void g.error(`Pricing for ${e.name} is not available.`);const s={itemType:"template_service",cartId:`cart-${Date.now()}`,templateId:e.id,productId:t._id,templateTypeId:e.type,templateName:e.name,quantity:50,material:"standard",finish:"matte",additionalFiles:[]};$(e=>[...e,s]),X(s),g.success(`${e.name} added to order!`)},[q,P]),Ie=e.useCallback((e,t=50)=>{const s={itemType:"template_service",cartId:`serv-${Date.now()}`,templateId:null,productId:e._id,templateTypeId:e.templateTypeId,templateName:e.name,quantity:t,material:"standard",finish:"matte",additionalFiles:[],productImage:e.images?.[0]||null};$(e=>[...e,s]),g.success(`${e.name} service added!`)},[]),Pe=e.useCallback((e,t)=>{const s=q.findIndex(t=>"product"===t.itemType&&t.productId===e._id);if(s>-1){const e=q[s];Ae(e.cartId,"quantity",e.quantity+t)}else{const s={itemType:"product",cartId:`prod-${Date.now()}`,productId:e._id,productName:e.name,productSku:e.sku,quantity:t,price:e.price,productImage:e.images?.[0]||null};$(e=>[...e,s])}g.success(`${t} x ${e.name} added to order!`)},[q]),Ae=e.useCallback((e,t,s)=>{$(a=>a.map(a=>a.cartId===e?{...a,[t]:s}:a))},[]),Te=e.useCallback(e=>{const t=q.find(t=>t.cartId===e);t&&G?.cartId===t.cartId&&X(null),$(t=>t.filter(t=>t.cartId!==e))},[q,G]),Oe=e.useCallback(e=>{const{name:t,value:s}=e.target;_(e=>({...e,[t]:s}))},[]),qe=e=>{ae(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};return s.jsxs("div",{className:"min-h-screen bg-slate-100 dark:bg-slate-950 font-sans text-slate-800 dark:text-slate-200 transition-colors duration-300",children:[s.jsx(f,{position:"top-center",toastOptions:{className:"dark:bg-slate-800 dark:text-white",duration:3e3}}),s.jsxs("div",{className:"p-4 sm:p-6 md:p-8 space-y-8",children:[s.jsxs("header",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx(w,{size:44,className:"text-cyan-500 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-4xl font-bold tracking-tight text-slate-900 dark:text-white",children:"Orders & Store"}),s.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1 text-sm",children:"Create new orders, buy supplies, and track progress"})]})]}),s.jsxs("button",{type:"button",onClick:()=>ee(!0),className:"relative p-3 bg-white dark:bg-slate-800 rounded-full shadow-lg border border-slate-200 dark:border-slate-700",children:[s.jsx(C,{className:"text-cyan-500"}),q.length>0&&s.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center",children:q.length})]})]}),s.jsx("div",{className:"border-b border-slate-200 dark:border-slate-700",children:s.jsx("nav",{className:"-mb-px flex space-x-4 sm:space-x-6 overflow-x-auto","aria-label":"Tabs",children:[{id:"new_order",label:"New Order",icon:y},{id:"orders",label:"Orders",icon:t},{id:"store",label:"Supplies Store",icon:I}].map(e=>s.jsxs("button",{type:"button",onClick:()=>we(e.id),className:(a===e.id?"border-cyan-500 text-cyan-600 dark:text-cyan-400":"border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-200")+" whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors flex items-center gap-2",children:[s.jsx(e.icon,{size:16})," ",e.label,"orders"===e.id&&le.length>0&&s.jsx("span",{className:"ml-1 bg-cyan-100 dark:bg-cyan-900/50 text-cyan-600 dark:text-cyan-400 text-xs font-bold px-2 py-0.5 rounded-full",children:le.length})]},e.id))})}),s.jsx(l,{mode:"wait",children:s.jsxs(r.div,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},exit:{y:-10,opacity:0},transition:{duration:.2},children:[x.page?s.jsx("div",{className:"flex justify-center py-20",children:s.jsx(F,{className:"animate-spin text-cyan-500",size:40})}):"new_order"===a&&s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 items-start",children:[s.jsxs("div",{className:"lg:col-span-2 space-y-8",children:[s.jsxs("div",{className:`${oe}`,children:[s.jsx("h3",{className:"font-semibold text-lg text-slate-800 dark:text-white mb-4",children:"1. Browse & Select Your Designs"}),s.jsxs("div",{className:"relative mb-4",children:[s.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:15}),s.jsx(me,{placeholder:"Search your templates...",className:"pl-10",value:U,onChange:e=>V(e.target.value)})]}),x.templates?s.jsx("div",{className:"h-48 flex items-center justify-center",children:s.jsx(F,{className:"animate-spin"})}):0===ue.length?s.jsx("p",{className:"text-center text-sm text-slate-500 py-4 h-48 flex items-center justify-center",children:"No printable templates found."}):s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:ue.map(e=>s.jsx(je,{template:e,onAddToCart:Ce,sizePresets:T},e.id))}),s.jsx(Ne,{currentPage:H,totalPages:he,onPageChange:K})]}),s.jsx(ye,{templateItem:G,onAddProduct:Pe}),q.length>0&&s.jsxs("div",{id:"order-items-section",ref:re,className:`${oe}`,children:[s.jsxs("h3",{className:"font-semibold text-lg text-slate-800 dark:text-white mb-4 flex items-center gap-2",children:[s.jsx(m,{size:20})," 2. Configure Your Order"]}),s.jsx("div",{className:"space-y-4",children:s.jsx(l,{children:ge.updatedCartItems.map(e=>s.jsx(ve,{item:e,onUpdate:Ae,onRemove:Te,template:xe.get(e.templateId),sizePresets:T},e.cartId))})})]})]}),s.jsx("div",{className:"lg:col-span-1",children:s.jsxs("div",{className:"sticky top-8 space-y-8",children:[s.jsx("div",{className:oe,children:s.jsx(ke,{products:P,onAddProduct:Pe,onAddService:Ie})}),q.length>0&&s.jsxs("div",{className:oe,children:[s.jsxs("h3",{className:"font-semibold text-lg text-slate-800 dark:text-white mb-4 flex items-center gap-2",children:[s.jsx(S,{size:20})," 3. Shipping & Checkout"]}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),E(!0);try{await u({items:q,shippingAddress:M,orderNotes:D}),g.success("Order placed successfully!"),$([]),R("");const e=await c();v(e||[]),i("orders"),ae(["active"])}catch(t){g.error(`Order failed: ${t.message||"An unknown error occurred."}`)}finally{E(!1)}},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium",children:"Full Name"}),s.jsx(me,{name:"fullName",value:M.fullName,onChange:Oe,required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium",children:"Address"}),s.jsx(me,{name:"addressLine1",value:M.addressLine1,onChange:Oe,required:!0})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium",children:"City"}),s.jsx(me,{name:"city",value:M.city,onChange:Oe,required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium",children:"State"}),s.jsx(me,{name:"state",value:M.state,onChange:Oe,required:!0})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium",children:"ZIP Code"}),s.jsx(me,{name:"zipCode",value:M.zipCode,onChange:Oe,required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium",children:"Country"}),s.jsx(me,{value:M.country,readOnly:!0})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium",children:"Order Notes (Optional)"}),s.jsx(pe,{value:D,onChange:e=>R(e.target.value)})]}),s.jsxs("div",{className:"pt-4 border-t border-slate-200/80 dark:border-slate-700/80",children:[s.jsx("h4",{className:"font-semibold text-md mb-2",children:"Order Summary"}),s.jsx("div",{className:"space-y-1 text-sm mb-4 max-h-24 overflow-y-auto pr-2",children:ge.updatedCartItems.map(e=>s.jsxs("div",{className:"flex justify-between text-slate-600 dark:text-slate-300",children:[s.jsx("span",{className:"truncate pr-2",children:e.productName||e.templateName}),s.jsxs("span",{children:["x",e.quantity]})]},e.cartId))}),s.jsxs("div",{className:"space-y-2 pt-2 border-t border-slate-200/80 dark:border-slate-700/80",children:[s.jsxs("div",{className:"flex justify-between text-sm text-slate-600 dark:text-slate-300",children:[s.jsx("span",{children:"Subtotal"}),s.jsx("span",{className:"font-medium",children:ce(ge.subtotal)})]}),ge.totalDiscount>0&&s.jsxs("div",{className:"flex justify-between text-sm text-green-600 dark:text-green-400",children:[s.jsx("span",{children:"Discounts"}),s.jsxs("span",{className:"font-medium",children:["-",ce(ge.totalDiscount)]})]}),s.jsxs("div",{className:"flex justify-between text-sm text-slate-600 dark:text-slate-300",children:[s.jsx("span",{children:"Shipping"}),s.jsx("span",{className:"font-medium",children:ge.shipping>0?ce(ge.shipping):ge.subtotal>0&&s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx("del",{children:ce(50)}),s.jsx("span",{className:"font-bold text-green-600 dark:text-green-400",children:"Free"})]})})]}),s.jsxs("div",{className:"flex justify-between text-xl font-bold border-t pt-3 mt-2 border-slate-200 dark:border-slate-700 text-slate-800 dark:text-white",children:[s.jsx("span",{children:"Total"}),s.jsx("span",{className:"text-cyan-600 dark:text-cyan-400",children:ce(ge.totalAmount)})]}),s.jsx("button",{type:"submit",disabled:L,className:"w-full btn-primary mt-4 !py-3 !text-base bg-green-600 hover:bg-green-700 disabled:bg-slate-400 dark:disabled:bg-slate-600 flex items-center justify-center",children:L?s.jsxs(s.Fragment,{children:[s.jsx(F,{className:"animate-spin mr-2"}),"Submitting..."]}):"Place Secure Order"})]})]})]})]})]})})]}),"orders"===a&&s.jsxs("div",{className:"space-y-6",children:[s.jsx(ze,{title:"Active Orders",icon:s.jsx(z,{size:20,className:"text-cyan-500"}),orders:le,selectedOrderId:Q,onSelectOrder:Z,count:le.length,isOpen:se.includes("active"),onToggle:()=>qe("active")}),s.jsx(ze,{title:"Order History",icon:s.jsx(Y,{size:20,className:"text-slate-500"}),orders:ie,selectedOrderId:Q,onSelectOrder:Z,count:ie.length,isOpen:se.includes("history"),onToggle:()=>qe("history")})]}),"store"===a&&s.jsx(ne,{isLoading:x.page,allProducts:P,onAddProductToCart:Pe})]},a)})]}),s.jsx(Se,{isOpen:J,onClose:()=>ee(!1),cartItems:ge.updatedCartItems,onUpdate:Ae,onRemove:Te,orderSummary:ge,onViewOrder:()=>{ee(!1),i("new_order"),setTimeout(()=>re.current?.scrollIntoView({behavior:"smooth"}),100)}})]})}export{Pe as default};
