import{r as e,V as s,j as t,a,m as l,R as r,S as i,aA as n,T as d,P as c,am as o,aB as x,aC as m,Z as p,aD as h,aE as u,aF as g,aG as b,aH as j,aI as f}from"./index-CxscT09Y.js";import{V as y,O as v}from"./index-Dg0Qh9jE.js";import{u as N}from"./useDarkMode-uytT8DPn.js";import{Q as k,aK as w,aA as C,aL as A,ar as S,aw as P,k as T,C as z,aM as I,aN as M,x as $,aO as F,aP as _,aQ as O,an as D,L,S as R,aR as U,aS as E}from"./lucide-react-Dm8ijxDf.js";import{b as q,X as B,f as W}from"./zoom-out-BkmDqjxf.js";import{G}from"./GradientButton-BmUonBY4.js";import{S as H}from"./Loading-BBArv5GN.js";import{S as J,T as K,C as Q,X as V}from"./x-C-WXaDeE.js";import{L as X,H as Y}from"./zap-C1hV3rjf.js";import{f as Z}from"./format-DhIoevPb.js";import{p as ee}from"./parseISO-BMtrrhUZ.js";import{f as se}from"./formatDistanceToNow-CR5Q7sOX.js";import{aK as te,aL as ae,aJ as le,aF as re}from"./ui-components-C7-nbk0S.js";import"./en-US-DXcIbJEK.js";import"./getRoundingMethod-DTdSz1j7.js";import"./index-C08PnImj.js";const ie=r.memo(({name:e,...s})=>{const a={LucideHome:C,ArrowLeftCircle:w,QrCode:k}[e]||i;return t.jsx(a,{...s})}),ne=({template:r,isHovered:i,isVisible:n})=>{const d=e.useRef(null),[c,o]=e.useState(1),[x,m]=e.useState(0),{isDarkMode:p}=N(),{sizePresets:h}=s(),u=r?.design?.pages||[],g=u.length>1;e.useEffect(()=>{if(!g||!i||!n)return;const e=setInterval(()=>{m(e=>(e+1)%u.length)},2e3);return()=>clearInterval(e)},[g,i,n,u.length]);const b=u[x];if(!b)return t.jsx("div",{className:`w-full h-full flex items-center justify-center text-slate-400 dark:text-slate-500 ${p?"bg-slate-800/50":"bg-slate-100"} rounded-lg`,children:"No Preview"});const j=b.sizePreset||r.defaultSizePreset,f=h.find(e=>e.id===j)||{width:400,height:250},y=f.width>=f.height?"horizontal":"vertical",v=b.front?.layouts?.[y]?.elements||[],w=b.front?.bgImage?`url(${b.front.bgImage}) center/cover`:b.front?.bgColor||(p?"#1a202c":"#f8fafc");e.useEffect(()=>{if(!d.current)return;const e=()=>{const e=d.current;e.offsetWidth>0&&e.offsetHeight>0&&o(Math.min(e.offsetWidth/f.width,e.offsetHeight/f.height))},s=new ResizeObserver(e);return s.observe(d.current),e(),()=>s.disconnect()},[f.width,f.height]);return t.jsx("div",{ref:d,className:"relative w-full h-full flex items-center justify-center overflow-hidden",children:t.jsx(a,{initial:!1,children:t.jsx(l.div,{variants:{enter:{opacity:0,scale:.98},center:{opacity:1,scale:1},exit:{opacity:0,scale:.98}},initial:"enter",animate:"center",exit:"exit",transition:{duration:.4,ease:[.43,.13,.23,.96]},className:"absolute inset-0 w-full h-full flex items-center justify-center",children:t.jsx("div",{className:"relative shadow-md rounded-md overflow-hidden",style:{width:`${f.width}px`,height:`${f.height}px`,transform:`scale(${c})`,background:w},children:v.map(e=>{const s={position:"absolute",left:`${e.x}px`,top:`${e.y}px`,width:`${e.width}px`,height:`${e.height}px`,backgroundColor:e.backgroundColor||"transparent",opacity:e.opacity??1,border:e.borderWidth?`${e.borderWidth}px solid ${e.borderColor||(p?"#4a5568":"#cbd5e1")}`:"none",borderRadius:e.borderRadius?String(e.borderRadius).includes("%")?e.borderRadius:`${e.borderRadius}px`:"0px"},a={color:e.color||(p?"#e2e8f0":"#1e293b"),fontSize:`${e.fontSize||10}px`,fontFamily:`"${e.fontFamily||"sans-serif"}"`,fontWeight:e.fontWeight,textAlign:e.textAlign,display:"flex",alignItems:"center",justifyContent:e.textAlign||"left",padding:"2px",overflow:"hidden"};switch(e.type){case"text":return t.jsx("div",{style:{...s,...a},children:(l=e.text||"",l.startsWith("{{")&&l.endsWith("}}")?l.slice(2,-2).replace(/([A-Z])/g," $1").trim():l)},e.id);case"image":return e.imageSrc||e.srcField?t.jsx("img",{src:e.imageSrc||`https://via.placeholder.com/150/E2E8F0/A0AEC0?text=${e.srcField}`,alt:"",style:{...s,objectFit:e.objectFit||"cover"}},e.id):t.jsx("div",{style:{...s,backgroundColor:p?"#2d3748":"#e2e8f0"},className:"flex items-center justify-center "+(p?"text-slate-500":"text-slate-400"),children:t.jsx(q,{size:.4*Math.min(e.width,e.height)})},e.id);case"icon":return t.jsx("div",{style:{...s,display:"flex",alignItems:"center",justifyContent:"center",color:e.color||(p?"#a0aec0":"#4a5568")},children:t.jsx(ie,{name:e.iconName,strokeWidth:e.strokeWidth||2,style:{width:"100%",height:"100%"}})},e.id);case"qrcode":case"barcode":return t.jsx("div",{style:{...s,backgroundColor:e.backgroundColor||"#fff"},className:"flex items-center justify-center text-slate-900 p-1",children:t.jsx(k,{className:"w-full h-full"})},e.id);case"shape":case"rectangle":case"circle":case"line":case"triangle":return t.jsx("div",{style:s},e.id);default:return null}var l})})},x)})})},de=e=>{if(!e||!e.data||!e.contentType||"R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"===e.data){return`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="300" height="200"><rect width="100%" height="100%" fill="#e2e8f0"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="20" fill="#94a3b8" font-family="sans-serif">No Image</text></svg>')))}`}return`data:${e.contentType};base64,${e.data}`},ce="relative p-4 sm:p-6 rounded-2xl shadow-lg transition-all duration-300 backdrop-blur-lg bg-white/70 border border-slate-200/70 dark:bg-slate-800/60 dark:border-white/10",oe="block w-full px-3 py-2 text-sm text-slate-700 dark:text-slate-200 bg-slate-50 dark:bg-slate-900/50 border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-all duration-200",xe={processing:{icon:c,color:"bg-sky-500/20 text-sky-500",label:"Processing"},printing:{icon:S,color:"bg-indigo-500/20 text-indigo-500",label:"Printing"},shipped:{icon:P,color:"bg-amber-500/20 text-amber-500",label:"Shipped"},delivered:{icon:z,color:"bg-green-500/20 text-green-500",label:"Delivered"},cancelled:{icon:B,color:"bg-red-500/20 text-red-500",label:"Cancelled"}},me=d,pe=e=>`${me}${e.toFixed(2)}`,he=e=>{if(!e?.data||!e.contentType)return null;if("string"==typeof e.data&&e.data.startsWith("data:"))return e.data;if("object"==typeof e.data&&"Buffer"===e.data.type&&Array.isArray(e.data.data)){const s=new Uint8Array(e.data.data),t=btoa(String.fromCharCode.apply(null,s));return`data:${e.contentType};base64,${t}`}return"string"==typeof e.data?`data:${e.contentType};base64,${e.data}`:null},ue=e=>new Promise((s,t)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>s(a.result),a.onerror=e=>t(e)}),ge=({title:e,value:s,icon:a,color:i,delay:n})=>t.jsx(l.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1,transition:{delay:.1*n}},className:ce,children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 rounded-lg",style:{backgroundColor:`${i}33`},children:r.cloneElement(a,{style:{color:i}})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:e}),t.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:s})]})]})}),be=({label:s,fileId:a,file:l,setFile:r})=>{const i=e.useMemo(()=>l?URL.createObjectURL(l):null,[l]);return e.useEffect(()=>()=>{i&&URL.revokeObjectURL(i)},[i]),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-semibold text-slate-600 dark:text-slate-300",children:s}),t.jsxs("div",{className:"mt-2 flex items-center gap-4",children:[t.jsx("div",{className:"w-20 h-20 rounded-lg bg-slate-200 dark:bg-slate-700 flex items-center justify-center overflow-hidden border border-slate-300 dark:border-slate-600",children:i?t.jsx("img",{src:i,alt:"Preview",className:"w-full h-full object-cover"}):t.jsx($,{size:24,className:"text-slate-400"})}),t.jsxs("div",{className:"space-y-1",children:[t.jsxs("label",{htmlFor:a,className:"cursor-pointer text-sm font-semibold text-cyan-600 dark:text-cyan-400 hover:underline",children:[l?"Change file":"Select a file",t.jsx("input",{id:a,type:"file",className:"sr-only",onChange:e=>r(e.target.files[0]),accept:"image/*"})]}),t.jsx("p",{className:"text-xs text-slate-500 max-w-[150px] truncate",children:l?l.name:"No file selected."})]}),l&&t.jsx("button",{type:"button",onClick:()=>r(null),className:"ml-auto p-1 rounded-full hover:bg-red-500/10",children:t.jsx(V,{size:16,className:"text-red-500"})})]})]})},je=({order:s,onUpdate:a,onClose:r})=>{const[i,n]=e.useState(""),[d,c]=e.useState(""),[o,x]=e.useState(null),[m,p]=e.useState(null),[h,u]=e.useState(!1);return t.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:r,children:t.jsx(l.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-slate-50 dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden",onClick:e=>e.stopPropagation(),children:t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!d.trim()||!i.trim())return void y.error("Carrier and Tracking Number are required.");u(!0);const s=y.loading("Processing shipment...");try{const e={carrier:i,trackingNumber:d};o&&(e.packedOrderImage=await ue(o)),m&&(e.shippingLabelImage=await ue(m)),await a(e),y.success("Shipment details updated!",{id:s}),r()}catch(t){y.error(`Update failed: ${t.message}`,{id:s})}finally{u(!1)}},children:[t.jsxs("header",{className:"p-6 border-b border-slate-200 dark:border-slate-700",children:[t.jsxs("h2",{className:"text-2xl font-bold",children:["Ship Order #",s.orderId.split("-")[1]]}),t.jsx("p",{className:"text-sm text-slate-500",children:"Enter tracking info to mark as shipped."})]}),t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"text-sm font-semibold",children:["Carrier ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"text",value:i,onChange:e=>n(e.target.value),className:oe,placeholder:"e.g., FedEx, UPS",required:!0})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"text-sm font-semibold",children:["Tracking Number ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("input",{type:"text",value:d,onChange:e=>c(e.target.value),className:oe,required:!0})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t border-slate-200 dark:border-slate-700",children:[t.jsx(be,{fileId:"packed-img",label:"Packed Order Photo",file:o,setFile:x}),t.jsx(be,{fileId:"label-img",label:"Shipping Label Photo",file:m,setFile:p})]})]}),t.jsxs("footer",{className:"p-4 bg-slate-100 dark:bg-slate-900/50 flex justify-end gap-3",children:[t.jsx("button",{type:"button",onClick:r,className:"btn-secondary",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:h,className:"btn-primary flex items-center gap-2",children:h?t.jsxs(t.Fragment,{children:[t.jsx(X,{className:"animate-spin",size:16})," Submitting..."]}):t.jsxs(t.Fragment,{children:[t.jsx(I,{size:16})," Confirm Shipment"]})})]})]})})})},fe=({onConfirm:s,onClose:a,order:r})=>{const[i,n]=e.useState(""),[d,c]=e.useState(!1);return t.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:a,children:t.jsxs(l.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"bg-slate-50 dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden",onClick:e=>e.stopPropagation(),children:[t.jsxs("header",{className:"p-6 border-b",children:[t.jsxs("h2",{className:"text-2xl font-bold",children:["Cancel Order #",r.orderId.split("-")[1]]}),t.jsx("p",{className:"text-sm text-slate-500",children:"Please provide a reason for cancellation."})]}),t.jsxs("div",{className:"p-6",children:[t.jsxs("label",{className:"text-sm font-semibold",children:["Reason for Cancellation ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsx("textarea",{value:i,onChange:e=>n(e.target.value),className:oe,rows:"4",placeholder:"e.g., Customer request, stock issue..."})]}),t.jsxs("footer",{className:"p-4 bg-slate-100 dark:bg-slate-900/50 flex justify-end gap-3",children:[t.jsx("button",{type:"button",onClick:a,className:"btn-secondary",children:"Back"}),t.jsxs("button",{onClick:async()=>{if(!i.trim())return void y.error("A reason for cancellation is required.");c(!0);const e=y.loading("Cancelling order...");try{await s({status:"cancelled",cancellationReason:i}),y.success("Order cancelled.",{id:e}),a()}catch(t){y.error(`Failed to cancel: ${t.message}`,{id:e})}finally{c(!1)}},disabled:d||!i.trim(),className:"btn-danger flex items-center gap-2",children:[d?t.jsx(X,{className:"animate-spin",size:16}):t.jsx(K,{size:16})," ","Confirm Cancellation"]})]})]})})},ye=({item:s})=>{const[a,l]=e.useState(null),[r,i]=e.useState(!1);e.useEffect(()=>{(async()=>{if("template_service"===s.itemType&&s.templateId){i(!0);try{const e=await p(s.templateId);l(e)}catch(e){l(null)}finally{i(!1)}}})()},[s.templateId,s.itemType]);const n=e.useMemo(()=>s.additionalFiles?.map(e=>({...e,url:he(e)})).filter(e=>e.url),[s.additionalFiles]);return t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 p-3 bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700",children:[t.jsx("div",{className:"w-full sm:w-48 h-32 sm:h-auto flex-shrink-0 bg-slate-100 dark:bg-slate-900/50 rounded-md flex items-center justify-center",children:"template_service"===s.itemType?r?t.jsx(X,{size:24,className:"animate-spin text-slate-400"}):a?t.jsx(ne,{template:a,isVisible:!0}):t.jsx(M,{size:24,className:"text-red-500"}):t.jsx("img",{src:de(s.images?.[0]),alt:s.nameSnapshot,className:"w-full h-full object-cover rounded-md"})}),t.jsxs("div",{className:"flex-grow",children:[t.jsxs("p",{className:"font-semibold",children:[s.quantity," x ",s.nameSnapshot]}),"template_service"===s.itemType&&t.jsxs("p",{className:"text-sm text-slate-500 capitalize",children:["Material: ",s.material," / Finish: ",s.finish]}),t.jsxs("p",{className:"text-sm text-slate-500",children:["Unit Price: ",pe(s.unitPriceSnapshot)]}),n?.length>0&&t.jsxs("div",{className:"mt-2 space-y-1 pt-2 border-t border-slate-200 dark:border-slate-700",children:[t.jsx("p",{className:"text-xs font-bold text-slate-500 dark:text-slate-400",children:"CUSTOMER FILES:"}),n.map(e=>t.jsxs("a",{href:e.url,download:e.name,className:"flex items-center gap-2 text-xs text-cyan-600 hover:underline",children:[t.jsx(W,{size:14})," ",e.name," (",(e.size/1024).toFixed(1)," KB)"]},e._id))]}),s.orderNotes&&t.jsxs("div",{className:"mt-2 pt-2 border-t border-slate-200 dark:border-slate-700",children:[t.jsx("p",{className:"text-xs font-bold text-slate-500 dark:text-slate-400",children:"NOTES:"}),t.jsxs("p",{className:"text-xs italic text-slate-600 dark:text-slate-300",children:['"',s.orderNotes,'"']})]})]})]})},ve=({order:e})=>{if("cancelled"===e.status)return t.jsx("div",{className:"p-4 rounded-lg bg-red-100 dark:bg-red-900/40 border border-red-200 dark:border-red-500/30",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(B,{className:"text-red-500",size:24}),t.jsxs("div",{children:[t.jsx("h5",{className:"font-bold text-red-800 dark:text-red-200",children:"Order Cancelled"}),e.cancellationReason&&t.jsxs("p",{className:"text-sm text-red-600 dark:text-red-300",children:["Reason: ",e.cancellationReason]})]})]})});const s=["processing","printing","shipped","delivered"],a=s.indexOf(e.status),l=s=>{switch(s){case"processing":return e.createdAt;case"shipped":return e.shipmentInfo?.shippedAt||e.updatedAt;default:return e.updatedAt}};return t.jsx("div",{className:"space-y-6",children:s.map((e,i)=>{const n=i<a,d=i===a;return t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center transition-all "+(n?"bg-cyan-500 text-white":d?"bg-white dark:bg-slate-700 ring-2 ring-cyan-500":"bg-slate-200 dark:bg-slate-700 border border-slate-300 dark:border-slate-600"),children:n?t.jsx(Q,{size:16}):r.createElement(xe[e].icon,{size:16,className:d?"text-cyan-500":"text-slate-400"})}),i<s.length-1&&t.jsx("div",{className:"w-0.5 flex-grow mt-2 transition-all "+(n?"bg-cyan-500":"bg-slate-300 dark:bg-slate-600")})]}),t.jsxs("div",{children:[t.jsx("p",{className:"font-bold capitalize "+(n||d?"text-slate-800 dark:text-white":"text-slate-400 dark:text-slate-500"),children:xe[e].label}),(n||d)&&t.jsx("p",{className:"text-xs text-slate-500",children:Z(ee(l(e)),"MMM d, h:mm a")})]})]},e)})})},Ne=({orderId:s,onOrderUpdated:l})=>{const[r,i]=e.useState(null),[n,d]=e.useState(!0),[c,p]=e.useState(!1),[h,u]=e.useState(!1);e.useEffect(()=>{(async()=>{d(!0);try{const e=await o(s);i(e)}catch(e){y.error("Could not load order details.")}finally{d(!1)}})()},[s]);const g=e=>b(m(r._id,e)),b=async e=>{try{const s=await e;i(s),l(s)}catch(s){throw y.error(`Update failed: ${s.message||"Please try again."}`),s}},j=e.useMemo(()=>r?.items.filter(e=>"template_service"===e.productType)||[],[r]),f=e.useMemo(()=>r?.items.filter(e=>"physical_good"===e.productType)||[],[r]);return n?t.jsx("div",{className:"p-10 flex items-center justify-center",children:t.jsx(X,{size:32,className:"animate-spin text-cyan-500"})}):r?t.jsxs(t.Fragment,{children:[t.jsx(a,{children:c&&t.jsx(je,{order:r,onUpdate:e=>b(x(r._id,e)),onClose:()=>p(!1)})}),t.jsx(a,{children:h&&t.jsx(fe,{order:r,onConfirm:g,onClose:()=>u(!1)})}),t.jsx("div",{className:"p-4 sm:p-6 bg-slate-100 dark:bg-slate-900/50 border-t border-slate-200 dark:border-slate-700",children:t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-4 gap-8",children:[t.jsxs("div",{className:"lg:col-span-1 xl:col-span-1 space-y-6",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("h4",{className:"font-bold",children:"Customer"}),t.jsx("p",{className:"text-sm font-semibold",children:r?.userId?.name}),t.jsx("p",{className:"text-sm text-slate-500",children:r?.userId?.email})]}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("h4",{className:"font-bold",children:"Shipping Address"}),t.jsxs("address",{className:"text-sm not-italic text-slate-600 dark:text-slate-300",children:[r?.shippingAddress.fullName,t.jsx("br",{}),r?.shippingAddress.addressLine1,t.jsx("br",{}),r?.shippingAddress.addressLine2&&t.jsxs(t.Fragment,{children:[r?.shippingAddress.addressLine2,t.jsx("br",{})]}),r?.shippingAddress?.city,", ",r?.shippingAddress.state," ",r?.shippingAddress?.zipCode]})]}),r?.orderNotes&&!r.cancellationReason&&t.jsxs("div",{className:"space-y-1",children:[t.jsx("h4",{className:"font-bold",children:"Order Notes"}),t.jsxs("p",{className:"text-sm italic bg-white dark:bg-slate-800 p-3 rounded-lg border border-slate-200 dark:border-slate-700",children:['"',r?.orderNotes,'"']})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-bold mb-4",children:"Order Status"}),t.jsx(ve,{order:r})]}),"cancelled"!==r.status&&"delivered"!==r.status&&t.jsxs("div",{className:"pt-4 border-t border-slate-200 dark:border-slate-700",children:[t.jsx("h4",{className:"font-bold mb-3",children:"Actions"}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:["processing"===r.status&&t.jsx(G,{onClick:()=>g({status:"printing"}),iconName:"Printer",size:"sm",children:"Move to Printing"}),"printing"===r.status&&t.jsx(G,{onClick:()=>p(!0),iconName:"Truck",size:"sm",children:"Mark as Shipped"}),"shipped"===r.status&&t.jsx(G,{onClick:()=>g({status:"delivered"}),iconName:"CheckCircle",size:"sm",children:"Mark as Delivered"}),t.jsx(G,{onClick:()=>u(!0),iconName:"X",variant:"danger",size:"sm",children:"Cancel Order"})]})]})]}),t.jsxs("div",{className:"lg:col-span-2 xl:col-span-3 space-y-6",children:[j.length>0&&t.jsxs("div",{children:[t.jsxs("h4",{className:"font-bold mb-3",children:["Printable Items (",j.length,")"]}),t.jsx("div",{className:"space-y-3",children:j.map(e=>t.jsx(ye,{item:e},e._id))})]}),f.length>0&&t.jsxs("div",{children:[t.jsxs("h4",{className:"font-bold mb-3",children:["Physical Goods (",f.length,")"]}),t.jsx("div",{className:"space-y-3",children:f.map(e=>t.jsx(ye,{item:e},e._id))})]}),t.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 pt-6 border-t border-slate-200/50 dark:border-slate-700/50",children:[r.shipmentInfo?.trackingNumber&&t.jsxs("div",{children:[t.jsx("h4",{className:"font-bold mb-3",children:"Shipment Details"}),t.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Carrier:"})," ",r.shipmentInfo.carrier]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Tracking #:"})," ",t.jsx("a",{href:"#",target:"_blank",rel:"noopener noreferrer",className:"text-cyan-500 hover:underline",children:r.shipmentInfo.trackingNumber})]})]}),t.jsxs("div",{className:"flex gap-4 pt-4 border-t border-slate-200 dark:border-slate-700",children:[r.shipmentInfo.packedOrderImage?.data&&t.jsxs("a",{href:he(r.shipmentInfo.packedOrderImage),target:"_blank",rel:"noopener noreferrer",className:"w-1/2 group",children:[t.jsx("p",{className:"text-xs font-semibold mb-1",children:"Packed Photo"}),t.jsx("img",{src:he(r.shipmentInfo.packedOrderImage),alt:"Packed Order",className:"w-full h-32 object-cover rounded-md border-2 border-transparent group-hover:border-cyan-500 transition-colors"})]}),r.shipmentInfo.shippingLabelImage?.data&&t.jsxs("a",{href:he(r.shipmentInfo.shippingLabelImage),target:"_blank",rel:"noopener noreferrer",className:"w-1/2 group",children:[t.jsx("p",{className:"text-xs font-semibold mb-1",children:"Label Photo"}),t.jsx("img",{src:he(r.shipmentInfo.shippingLabelImage),alt:"Shipping Label",className:"w-full h-32 object-cover rounded-md border-2 border-transparent group-hover:border-cyan-500 transition-colors"})]})]})]})]}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-bold mb-3",children:"Financial Summary"}),t.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700 space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Subtotal"}),t.jsx("span",{children:pe(r.subtotal)})]}),t.jsxs("div",{className:"flex justify-between text-green-600 dark:text-green-400",children:[t.jsx("span",{children:"Discount"}),t.jsxs("span",{children:["-",pe(r.discount)]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Shipping"}),t.jsx("span",{children:pe(r.shippingCost)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{children:"Tax"}),t.jsx("span",{children:pe(r.tax)})]}),t.jsxs("div",{className:"flex justify-between font-bold text-lg border-t pt-2 mt-2 border-slate-200 dark:border-slate-700",children:[t.jsx("span",{children:"Total"}),t.jsx("span",{children:pe(r.totalAmount)})]})]})]})]})]})]})})]}):t.jsx("div",{className:"p-10 text-center text-red-500",children:"Failed to load order information."})},ke=({order:e,isSelected:s,onToggle:r,onOrderUpdated:i})=>{const n=xe[e.status]||xe.processing,d=n.icon;return t.jsxs(l.div,{layout:!0,className:"bg-white/60 dark:bg-slate-800/50 backdrop-blur-md rounded-xl shadow-md overflow-hidden border border-slate-200 dark:border-slate-700",children:[t.jsx("button",{type:"button",onClick:r,className:"w-full text-left p-4 hover:bg-slate-500/5 transition-colors",children:t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 items-center",children:[t.jsxs("div",{className:"md:col-span-2",children:[t.jsxs("p",{className:"font-bold",children:["#",e?.orderId?.split("-")[1]]}),t.jsx("p",{className:"text-sm text-slate-500",children:e?.userId?.name})]}),t.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:[Z(ee(e.createdAt),"MMM d, yyyy"),t.jsx("p",{className:"text-xs text-slate-400",children:se(ee(e?.createdAt),{addSuffix:!0})})]}),t.jsx("div",{className:"font-semibold text-lg text-right md:text-left",children:pe(e.totalAmount)}),t.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-semibold justify-self-end ${n.color}`,children:[t.jsx(d,{size:16}),t.jsx("span",{className:"capitalize",children:n.label})]})]})}),t.jsx(a,{children:s&&t.jsx(Ne,{orderId:e._id,onOrderUpdated:i})})]})};function we(){const[s,a]=e.useState([]),[l,r]=e.useState(!0),[i,d]=e.useState(null),[o,x]=e.useState("all"),[m,p]=e.useState(""),[h,u]=e.useState({currentPage:1,hasMore:!0}),g=e.useCallback(async(e,s=!1)=>{r(!0);try{const t=await n(e);a(e=>s?[...e,...t.orders]:t.orders),u({currentPage:t.currentPage,hasMore:t.hasMore})}catch(t){y.error("Failed to fetch order list.")}finally{r(!1)}},[]);e.useEffect(()=>{g(1)},[g]);const b=e=>{a(s=>s.map(s=>s._id===e._id?e:s))},j=e.useMemo(()=>({processing:s.filter(e=>"processing"===e.status).length,printing:s.filter(e=>"printing"===e.status).length,shipped:s.filter(e=>"shipped"===e.status).length,revenue:s.filter(e=>"delivered"===e.status).reduce((e,s)=>e+s.totalAmount,0)}),[s]),f=e.useMemo(()=>s.filter(e=>("all"===o||e.status===o)&&(""===m||e.orderId.toLowerCase().includes(m.toLowerCase())||e.userId.name.toLowerCase().includes(m.toLowerCase()))),[s,o,m]);return t.jsxs("div",{className:"space-y-8",children:[t.jsx(v,{position:"top-center",toastOptions:{className:"dark:bg-slate-700 dark:text-white"}}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(ge,{title:"Total Revenue",value:pe(j.revenue),icon:t.jsx(A,{size:24}),color:"#10b981",delay:0}),t.jsx(ge,{title:"Processing",value:j.processing,icon:t.jsx(c,{size:24}),color:"#0ea5e9",delay:1}),t.jsx(ge,{title:"Printing",value:j.printing,icon:t.jsx(S,{size:24}),color:"#8b5cf6",delay:2}),t.jsx(ge,{title:"Shipped",value:j.shipped,icon:t.jsx(P,{size:24}),color:"#f97316",delay:3})]}),t.jsxs("div",{className:ce,children:[t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[t.jsxs("div",{className:"relative flex-grow",children:[t.jsx(J,{size:18,className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-slate-400"}),t.jsx("input",{type:"text",placeholder:"Search by Order ID or Customer Name...",value:m,onChange:e=>p(e.target.value),className:`${oe} !pl-10`})]}),t.jsx("div",{className:"flex-shrink-0 flex space-x-1 p-1 bg-slate-200 dark:bg-slate-900/50 rounded-lg overflow-x-auto",children:["all","processing","printing","shipped","delivered","cancelled"].map(e=>t.jsx("button",{type:"button",onClick:()=>x(e),className:"w-full px-4 py-1.5 text-sm font-medium rounded-md transition-colors "+(o===e?"bg-white dark:bg-slate-700 text-cyan-600 dark:text-cyan-400 shadow-sm":"text-slate-500 dark:text-slate-400 hover:bg-slate-300/50 dark:hover:bg-slate-800"),children:t.jsx("span",{className:"capitalize",children:e})},e))})]}),l&&0===s.length?t.jsx("div",{className:"text-center py-20",children:t.jsx(X,{size:32,className:"animate-spin mx-auto text-cyan-500"})}):0===f.length?t.jsxs("div",{className:"text-center py-20 text-slate-500",children:[t.jsx(T,{size:40,className:"mx-auto mb-2"}),t.jsx("p",{children:"No orders match your criteria."})]}):t.jsx("div",{className:"space-y-4",children:f.map(e=>t.jsx(ke,{order:e,isSelected:i===e._id,onToggle:()=>{return s=e._id,void d(e=>e===s?null:s);var s},onOrderUpdated:b},e._id))}),h.hasMore&&t.jsx("div",{className:"mt-6 text-center",children:t.jsx("button",{onClick:()=>g(h.currentPage+1,!0),disabled:l,className:"btn-secondary",children:l?t.jsx(t.Fragment,{children:t.jsx(H,{})}):"Load More Orders"})})]})]})}const Ce="relative p-4 sm:p-6 rounded-2xl shadow-lg transition-all duration-300 backdrop-blur-lg bg-white/70 border border-slate-200/70 dark:bg-slate-800/60 dark:border-white/10",Ae=d,Se=e=>`${Ae}${e?.toFixed(2)||"0.00"}`,Pe=({title:e,value:s,icon:a,color:i,delay:n})=>t.jsx(l.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1,transition:{delay:.1*n}},className:Ce,children:t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-3 rounded-lg",style:{background:`${i}33`},children:r.cloneElement(a,{style:{color:i}})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:e}),t.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:s})]})]})}),Te={pending:{icon:Y,color:"bg-amber-500/20 text-amber-500",label:"Pending"},processing:{icon:X,color:"bg-blue-500/20 text-blue-500",label:"Processing"},completed:{icon:z,color:"bg-green-500/20 text-green-500",label:"Completed"},failed:{icon:B,color:"bg-red-500/20 text-red-500",label:"Failed"},refunded:{icon:D,color:"bg-slate-500/20 text-slate-500",label:"Refunded"},cancelled:{icon:O,color:"bg-gray-500/20 text-gray-500",label:"Cancelled"}},ze=({transaction:e,onToggle:s})=>{const a=Te[e.status]||Te.pending;return t.jsx(l.div,{layout:!0,className:"bg-white/60 dark:bg-slate-800/50 backdrop-blur-md rounded-xl shadow-md overflow-hidden border border-slate-200 dark:border-slate-700",children:t.jsx("button",{onClick:s,className:"w-full text-left p-4 hover:bg-slate-500/5 transition-colors",children:t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 items-center",children:[t.jsxs("div",{className:"md:col-span-2",children:[t.jsx("p",{className:"font-bold text-sm font-mono",children:e.transactionId.toUpperCase()}),t.jsx("p",{className:"text-sm text-slate-500",children:e.user?.name||"N/A"})]}),t.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-300",children:[Z(ee(e.createdAt),"MMM d, yyyy"),t.jsx("p",{className:"text-xs text-slate-400",children:se(ee(e.createdAt),{addSuffix:!0})})]}),t.jsx("div",{className:"font-semibold text-lg text-right md:text-left",children:Se(e.totalAmount)}),t.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-semibold justify-self-end ${a.color}`,children:[t.jsx(a.icon,{size:16}),t.jsx("span",{className:"capitalize",children:a.label})]})]})})})},Ie=({transaction:s,onTransactionUpdated:a})=>{const[l,r]=e.useState(s.notes||""),[i,n]=e.useState(!1),d=async(e,t={})=>{n(!0);const l=y.loading("Updating transaction...");try{const r={status:e,...t},i=await u(s._id,r);a(i),y.success("Transaction updated successfully!",{id:l})}catch(r){y.error(r.message||"Failed to update transaction.",{id:l})}finally{n(!1)}};return t.jsx("div",{className:"p-4 sm:p-6 bg-slate-100 dark:bg-slate-900/50 border-t border-slate-200 dark:border-slate-700",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"font-bold",children:"Customer Details"}),t.jsxs("div",{className:"text-sm space-y-1",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"User:"})," ",s.user?.name]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Email:"})," ",s.user?.email]}),t.jsxs("p",{children:[t.jsx("strong",{children:"Organization:"})," ",s.organization?.name]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"font-bold",children:"Items Purchased"}),t.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-slate-600 dark:text-slate-300",children:s.items.map((e,s)=>t.jsxs("li",{children:[e.description," (Qty: ",e.quantity,") - ",Se(e.price)]},s))})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h4",{className:"font-bold",children:"Payment Details"}),t.jsxs("div",{className:"text-sm space-y-1",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Method:"})," ",t.jsx("span",{className:"capitalize",children:s.paymentMethod.replace("_"," ")})]}),s.gatewayDetails?.providerTransactionId&&t.jsxs("p",{children:[t.jsx("strong",{children:"Gateway ID:"})," ",s.gatewayDetails.providerTransactionId]}),s.dueDate&&t.jsxs("p",{children:[t.jsx("strong",{children:"Due Date:"})," ",Z(ee(s.dueDate),"MMM d, yyyy")]}),s.gatewayDetails?.paidAt&&t.jsxs("p",{children:[t.jsx("strong",{children:"Paid On:"})," ",Z(ee(s.gatewayDetails.paidAt),"MMM d, yyyy")]})]})]}),t.jsxs("div",{className:"md:col-span-3 space-y-4",children:[t.jsx("h4",{className:"font-bold",children:"Admin Notes"}),t.jsx("textarea",{value:l,onChange:e=>r(e.target.value),className:"block w-full px-3 py-2 text-sm text-slate-700 dark:text-slate-200 bg-slate-50 dark:bg-slate-900/50 border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 transition-all duration-200 dark:bg-slate-800",placeholder:"Add internal notes about this transaction...",rows:3})]}),t.jsxs("div",{className:"md:col-span-3 flex justify-between items-center pt-4 border-t border-slate-300 dark:border-slate-700",children:[t.jsx("div",{children:t.jsx(G,{onClick:()=>d(s.status,{notes:l}),disabled:i,size:"sm",iconName:"Save",children:"Save Notes"})}),"pending"===s.status&&t.jsxs("div",{className:"flex gap-2",children:[t.jsx(G,{onClick:()=>d("cancelled",{notes:l}),disabled:i,size:"sm",variant:"danger",iconName:"Ban",children:"Cancel"}),t.jsx(G,{onClick:()=>d("completed",{notes:l}),disabled:i,size:"sm",iconName:"CheckCircle",children:"Mark Completed"})]})]})]})})};function Me(){const[s,r]=e.useState([]),[i,n]=e.useState(!0),[d,c]=e.useState(null);e.useEffect(()=>{(async()=>{n(!0);try{const e=await h();r(e||[])}catch(e){y.error("Failed to fetch transaction list.")}finally{n(!1)}})()},[]);const o=e=>{r(s=>s.map(s=>s._id===e._id?e:s))},x=e.useMemo(()=>({totalTransactions:s.length,pending:s.filter(e=>"pending"===e.status).length,failed:s.filter(e=>"failed"===e.status).length,totalRevenue:s.filter(e=>"completed"===e.status).reduce((e,s)=>e+s.totalAmount,0)}),[s]);return t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsx(Pe,{title:"Total Revenue",value:Se(x.totalRevenue),icon:t.jsx(A,{size:24}),color:"#10b981",delay:0}),t.jsx(Pe,{title:"Total Transactions",value:x.totalTransactions,icon:t.jsx(F,{size:24}),color:"#3b82f6",delay:1}),t.jsx(Pe,{title:"Pending Payments",value:x.pending,icon:t.jsx(Y,{size:24}),color:"#f97316",delay:2}),t.jsx(Pe,{title:"Failed Transactions",value:x.failed,icon:t.jsx(_,{size:24}),color:"#ef4444",delay:3})]}),t.jsx("div",{className:Ce,children:i?t.jsx("div",{className:"text-center py-20",children:t.jsx(X,{size:32,className:"animate-spin mx-auto text-cyan-500"})}):0===s.length?t.jsx("div",{className:"text-center py-20 text-slate-500",children:t.jsx("p",{children:"No transactions found."})}):t.jsx("div",{className:"space-y-4",children:s.map(e=>t.jsxs("div",{children:[t.jsx(ze,{transaction:e,onToggle:()=>c(s=>s===e._id?null:e._id)}),t.jsx(a,{children:d===e._id&&t.jsx(l.div,{layout:!0,initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:t.jsx(Ie,{transaction:e,onTransactionUpdated:o})})})]},e._id))})})]})}const{Search:$e,Package:Fe,Server:_e,Plus:Oe,Save:De,Edit:Le,Trash2:Re,Loader2:Ue,Image:Ee,AlertTriangle:qe,ChevronLeft:Be,ChevronRight:We}=L,Ge=e=>null!=e?`₹${e.toFixed(2)}`:"₹0.00",He=e=>{if(!e||!e.data||!e.contentType||"R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"===e.data){return`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent('\n      <svg xmlns="http://www.w3.org/2000/svg" width="300" height="200">\n        <rect width="100%" height="100%" fill="#e2e8f0"/>\n        <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle"\n              font-size="20" fill="#94a3b8" font-family="Arial, sans-serif">\n          No Image\n        </text>\n      </svg>')))}`}return`data:${e.contentType};base64,${e.data}`},Je=({isOpen:e,onClose:s,children:r})=>t.jsx(a,{children:e&&t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[t.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:s}),t.jsx(l.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:25},className:"relative w-full max-w-4xl max-h-[90vh] bg-slate-100 dark:bg-slate-900 rounded-2xl shadow-2xl flex flex-col",children:r})]})}),Ke=({existingImages:s=[],onImagesChange:a})=>{const[l,r]=e.useState([]),i=e=>new Promise((s,t)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>s({dataUrl:a.result}),a.onerror=e=>t(e)});return t.jsx(le,{label:"Product Images (Uploading new images will replace all existing ones)",children:t.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-5 gap-3",children:[s.map((e,s)=>t.jsx("div",{className:"relative group",children:t.jsx("img",{src:He(e),alt:"Existing product",className:"w-full h-24 object-cover rounded-lg shadow-md"})},`existing-${s}`)),l.map((e,s)=>t.jsx("div",{children:t.jsx("img",{src:e,alt:"New preview",className:"w-full h-24 object-cover rounded-lg shadow-md border-2 border-cyan-500"})},`new-${s}`)),t.jsxs("label",{htmlFor:"file-upload",className:"w-full h-24 flex flex-col items-center justify-center bg-slate-200 dark:bg-slate-800 border-2 border-dashed border-slate-400 dark:border-slate-600 rounded-lg cursor-pointer hover:bg-slate-300 dark:hover:bg-slate-700 transition",children:[t.jsx(Ee,{className:"text-slate-500"}),t.jsx("span",{className:"text-xs mt-1 text-slate-500",children:"Upload"}),t.jsx("input",{id:"file-upload",type:"file",multiple:!0,accept:"image/png, image/jpeg",className:"sr-only",onChange:async e=>{const s=Array.from(e.target.files);if(0!==s.length){y.loading("Processing images...",{id:"img-processing"});try{const e=await Promise.all(s.map(i));r(e.map(e=>e.dataUrl)),a(e),y.success("Images ready!",{id:"img-processing"})}catch(t){y.error("Could not process images.",{id:"img-processing"})}}}})]})]})})},Qe=({product:s,onSave:a,onCancel:l,templateTypes:r})=>{const[i,n]=e.useState(s),[d,c]=e.useState(!1),o="template_service"===i.productType,x=(e,s)=>n(t=>({...t,[e]:s})),m=(e,s)=>{try{const t=JSON.parse(s.target.value);x(e,t)}catch(t){y.error("Invalid JSON format.")}},p=(e,s,t)=>{const a=[...i.volumeDiscounts||[]];a[e]={...a[e],[s]:Number(t)},x("volumeDiscounts",a)};return t.jsxs("form",{onSubmit:async e=>{e.preventDefault(),c(!0);const t=y.loading(s._id?"Updating product...":"Creating product...");try{const e={...i};s._id&&e.images&&e.images.length>0&&!e.images[0].dataUrl&&delete e.images;const l=s._id?await j(s._id,e):await f(e);y.success("Product saved!",{id:t}),a(l)}catch(l){y.error(`Save failed: ${l.message||"Unknown error"}`,{id:t})}finally{c(!1)}},className:"flex flex-col h-full",children:[t.jsx("header",{className:"p-6 flex-shrink-0",children:t.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:s._id?`Edit: ${s.name}`:"Create New Product"})}),t.jsxs("div",{className:"flex-grow overflow-y-auto px-6 pb-6 space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx(Ke,{onImagesChange:e=>x("images",e)}),t.jsx(le,{label:"Product Name",children:t.jsx(te,{type:"text",value:i.name,onChange:e=>x("name",e.target.value),required:!0})}),t.jsx(le,{label:"Description",children:t.jsx(re,{value:i.description,onChange:e=>x("description",e.target.value),rows:"4",required:!0})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx(le,{label:"Product Type",children:t.jsx(ae,{value:i.productType,onChange:e=>x("productType",e),options:[{id:"physical_good",name:"Physical Good"},{id:"template_service",name:"Template Service"}]})}),o?t.jsxs(t.Fragment,{children:[t.jsx(le,{label:"Template Type",children:t.jsx(ae,{value:i.templateTypeId,onChange:e=>x("templateTypeId",e),options:r,required:!0})}),t.jsx(le,{label:"Base Price",children:t.jsx(te,{type:"number",step:"0.01",value:i.basePrice,onChange:e=>x("basePrice",e.target.value),required:!0})})]}):t.jsxs(t.Fragment,{children:[t.jsx(le,{label:"SKU",children:t.jsx(te,{type:"text",value:i.sku,onChange:e=>x("sku",e.target.value),required:!0})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx(le,{label:"Price",children:t.jsx(te,{type:"number",step:"0.01",value:i.price,onChange:e=>x("price",e.target.value),required:!0})}),t.jsx(le,{label:"Stock",children:t.jsx(te,{type:"number",value:i.stock,onChange:e=>x("stock",e.target.value),required:!0})})]})]}),t.jsx(le,{label:"Status",children:t.jsx(ae,{value:i.status,onChange:e=>x("status",e),options:[{id:"draft",name:"Draft"},{id:"active",name:"Active"},{id:"archived",name:"Archived"}]})})]})]}),o&&t.jsxs("div",{className:"pt-4 mt-4 border-t border-slate-300 dark:border-slate-700 grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsx(le,{label:"Material Modifiers (JSON)",children:t.jsx(re,{value:JSON.stringify(i.materialModifiers||{},null,2),onChange:e=>m("materialModifiers",e),rows:"4"})}),t.jsx(le,{label:"Finish Modifiers (JSON)",children:t.jsx(re,{value:JSON.stringify(i.finishModifiers||{},null,2),onChange:e=>m("finishModifiers",e),rows:"4"})}),t.jsxs(le,{label:"Volume Discounts",children:[t.jsx("div",{className:"space-y-2",children:(i.volumeDiscounts||[]).map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(te,{type:"number",placeholder:"Threshold",value:e.quantityThreshold,onChange:e=>p(s,"quantityThreshold",e.target.value)}),t.jsx(te,{type:"number",placeholder:"Discount %",value:e.discountPercentage,onChange:e=>p(s,"discountPercentage",e.target.value)}),t.jsx("button",{type:"button",onClick:()=>{return e=s,x("volumeDiscounts",i.volumeDiscounts.filter((s,t)=>t!==e));var e},className:"p-2 text-red-500 hover:bg-red-500/10 rounded-full",children:t.jsx(Re,{size:16})})]},s))}),t.jsx("button",{type:"button",onClick:()=>x("volumeDiscounts",[...i.volumeDiscounts||[],{quantityThreshold:0,discountPercentage:0}]),className:"text-sm font-semibold text-cyan-600 hover:text-cyan-500 mt-2",children:"Add Discount Tier"})]})]})]}),t.jsxs("footer",{className:"p-4 bg-slate-200 dark:bg-slate-800 flex justify-between items-center flex-shrink-0 border-t border-slate-300 dark:border-slate-700",children:[t.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 rounded-lg font-semibold hover:bg-slate-300 dark:hover:bg-slate-700 transition-colors",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:d,className:"px-6 py-2 rounded-lg font-semibold bg-cyan-500 text-white hover:bg-cyan-600 focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2 dark:focus:ring-offset-slate-900 transition flex items-center gap-2",children:d?t.jsxs(t.Fragment,{children:[t.jsx(Ue,{className:"animate-spin"})," Saving..."]}):t.jsxs(t.Fragment,{children:[t.jsx(De,{})," Save Product"]})})]})]})},Ve=({product:e,onEdit:s,onDelete:a})=>t.jsxs(l.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"bg-white dark:bg-slate-800 rounded-xl shadow-lg overflow-hidden flex flex-col transition-all hover:shadow-2xl hover:-translate-y-1",children:[t.jsx("img",{src:He(e.images[0]),alt:e.name,className:"w-full h-40 object-cover"}),t.jsxs("div",{className:"p-5 flex flex-col flex-grow",children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("span",{className:"inline-flex items-center gap-2 text-xs font-bold uppercase tracking-wider px-2 py-1 rounded-full "+("physical_good"===e.productType?"bg-cyan-100 dark:bg-cyan-900/50 text-cyan-800 dark:text-cyan-300":"bg-purple-100 dark:bg-purple-900/50 text-purple-800 dark:text-purple-300"),children:["physical_good"===e.productType?t.jsx(Fe,{size:12}):t.jsx(_e,{size:12})," ",e.productType.replace("_"," ")]}),t.jsx("span",{className:"text-xs font-bold px-2 py-1 rounded-full "+("active"===e.status?"bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-300":"draft"===e.status?"bg-yellow-100 dark:bg-yellow-900/50 text-yellow-800 dark:text-yellow-300":"bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-400"),children:e.status})]}),t.jsx("h3",{className:"text-lg font-bold mt-2 text-slate-900 dark:text-white flex-grow",children:e.name}),t.jsx("div",{className:"mt-4 pt-4 border-t border-slate-200 dark:border-slate-700 space-y-2 text-sm",children:"physical_good"===e.productType?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"SKU"}),t.jsx("span",{className:"font-mono text-slate-700 dark:text-slate-300",children:e.sku})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Price"}),t.jsx("span",{className:"font-bold text-lg text-slate-800 dark:text-white",children:Ge(e.price)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Stock"}),t.jsxs("span",{className:"font-semibold text-slate-700 dark:text-slate-300",children:[e.stock," units"]})]})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Template ID"}),t.jsx("span",{className:"font-mono text-slate-700 dark:text-slate-300",children:e.templateTypeId})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Base Price"}),t.jsx("span",{className:"font-bold text-lg text-slate-800 dark:text-white",children:Ge(e.basePrice)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Discounts"}),t.jsxs("span",{className:"font-semibold text-slate-700 dark:text-slate-300",children:[e.volumeDiscounts?.length||0," tiers"]})]})]})})]}),t.jsxs("div",{className:"p-2 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-700 flex justify-end gap-2",children:[t.jsx("button",{onClick:s,className:"p-2 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 transition",children:t.jsx(Le,{size:16})}),t.jsx("button",{onClick:a,className:"p-2 rounded-lg text-red-500 hover:bg-red-500/10 transition",children:t.jsx(Re,{size:16})})]})]}),Xe=({currentPage:e,totalPages:s,onPageChange:a})=>t.jsxs("div",{className:"flex items-center justify-center gap-2 mt-8",children:[t.jsx("button",{onClick:()=>a(e-1),disabled:1===e,className:"p-2 rounded-lg disabled:opacity-50 hover:bg-slate-200 dark:hover:bg-slate-700",children:t.jsx(Be,{size:20})}),t.jsxs("span",{className:"font-semibold text-slate-600 dark:text-slate-300",children:["Page ",e," of ",s]}),t.jsx("button",{onClick:()=>a(e+1),disabled:e===s,className:"p-2 rounded-lg disabled:opacity-50 hover:bg-slate-200 dark:hover:bg-slate-700",children:t.jsx(We,{size:20})})]});function Ye(){const[s,r]=e.useState([]),[i,n]=e.useState([]),[d,c]=e.useState(!0),[o,x]=e.useState(!1),[m,p]=e.useState(null),[h,u]=e.useState(""),[j,f]=e.useState({productType:"all",status:"all"}),[N,k]=e.useState(1),w=e.useCallback(async()=>{c(!0);try{const[e,s]=await Promise.all([g(),b()]);r(e||[]),n(s||[])}catch(e){y.error(`Failed to load catalog: ${e.message}`)}finally{c(!1)}},[]);e.useEffect(()=>{w()},[w]);const C=e.useMemo(()=>s.filter(e=>"all"===j.productType||e.productType===j.productType).filter(e=>"all"===j.status||e.status===j.status).filter(e=>e.name.toLowerCase().includes(h.toLowerCase())||e.sku&&e.sku.toLowerCase().includes(h.toLowerCase())),[s,j,h]);e.useEffect(()=>{k(1)},[j,h]);const A=e.useMemo(()=>{const e=30*(N-1);return C.slice(e,e+30)},[C,N,30]),S=Math.max(1,Math.ceil(C.length/30)),P=(e=null)=>{const s={productType:"physical_good",name:"",description:"",status:"draft",images:[],sku:"",price:0,stock:0,category:"Accessories",templateTypeId:i[0]?.id||"",basePrice:0,materialModifiers:{},finishModifiers:{},volumeDiscounts:[]};p(e||s),x(!0)},T=()=>{x(!1),p(null)};return t.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900/95 text-slate-800 dark:text-slate-200",children:[t.jsx(v,{position:"bottom-right",toastOptions:{className:"dark:bg-slate-700 dark:text-white",duration:4e3}}),t.jsxs("main",{className:"p-4 md:p-8 space-y-8 max-w-screen-2xl mx-auto",children:[t.jsxs("header",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:"Product Catalog"}),t.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Manage all physical goods and template printing services."})]}),t.jsxs("button",{onClick:()=>P(),className:"px-5 py-2.5 rounded-lg font-semibold bg-cyan-500 text-white hover:bg-cyan-600 focus:ring-2 focus:ring-cyan-500 focus:ring-offset-2 dark:focus:ring-offset-slate-900 transition flex items-center gap-2 whitespace-nowrap",children:[t.jsx(Oe,{size:18})," Add New Product"]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 p-4 bg-slate-100 dark:bg-slate-800/50 rounded-xl",children:[t.jsxs("div",{className:"relative lg:col-span-2",children:[t.jsx($e,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:20}),t.jsx(te,{type:"text",placeholder:"Search by name or SKU...",className:"pl-10",value:h,onChange:e=>u(e.target.value)})]}),t.jsx(ae,{value:j.productType,onChange:e=>f(s=>({...s,productType:e})),options:[{id:"all",name:"All Types"},{id:"physical_good",name:"Physical Goods"},{id:"template_service",name:"Template Services"}]}),t.jsx(ae,{value:j.status,onChange:e=>f(s=>({...s,status:e})),options:[{id:"all",name:"All Statuses"},{id:"active",name:"Active"},{id:"draft",name:"Draft"},{id:"archived",name:"Archived"}]})]}),t.jsx(a,{mode:"wait",children:t.jsx(l.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:d?t.jsxs("div",{className:"text-center py-20 flex flex-col items-center gap-3",children:[t.jsx(Ue,{className:"animate-spin text-cyan-500",size:40}),t.jsx("span",{children:"Loading Catalog..."})]}):A.length>0?t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6",children:A.map(e=>t.jsx(Ve,{product:e,onEdit:()=>P(e),onDelete:()=>(async e=>{if(window.confirm(`Are you sure you want to archive "${e.name}"? This action cannot be undone.`)){const t=y.loading("Archiving product...");try{const{product:s}=await archiveProduct(e._id);r(e=>e.map(e=>e._id===s._id?{...e,...s}:e)),y.success("Product archived.",{id:t})}catch(s){y.error(`Failed to archive: ${s.message}`,{id:t})}}})(e)},e._id))}):t.jsxs("div",{className:"text-center py-20 border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl flex flex-col items-center gap-4",children:[t.jsx(qe,{className:"text-yellow-500",size:40}),t.jsx("h3",{className:"text-xl font-semibold",children:"No Products Found"}),t.jsx("p",{className:"text-slate-500",children:"Your filters did not match any products. Try adjusting your search."})]})},N+JSON.stringify(j)+h)}),S>1&&t.jsx(Xe,{currentPage:N,totalPages:S,onPageChange:k})]}),t.jsx(Je,{isOpen:o,onClose:T,children:o&&t.jsx(Qe,{product:m,onSave:e=>{r(s=>{const t=s.findIndex(s=>s._id===e._id);if(t>-1){const a=[...s];return a[t]=e,a}return[e,...s]}),T()},onCancel:T,templateTypes:i})})]})}function Ze(){const s=e.useRef(null),{isDarkMode:r}=N(),[i,n]=e.useState("orders"),d={orders:{label:"Orders",icon:t.jsx(c,{size:16}),component:t.jsx(we,{})},transactions:{label:"Transactions",icon:t.jsx(E,{size:16}),component:t.jsx(Me,{})},pricing:{label:"Configs",icon:t.jsx(U,{size:16}),component:t.jsx(Ye,{})}};return e.useEffect(()=>{const e=e=>{s.current&&(s.current.style.setProperty("--mouse-x",`${e.clientX}px`),s.current.style.setProperty("--mouse-y",`${e.clientY}px`))};return window.addEventListener("mousemove",e),()=>window.removeEventListener("mousemove",e)},[]),t.jsxs("div",{className:"min-h-screen bg-slate-100 dark:bg-slate-950 font-sans text-slate-800 dark:text-slate-200 transition-colors duration-300",style:{backgroundImage:`\n      radial-gradient(circle at var(--mouse-x) var(--mouse-y), ${r?"rgba(6, 182, 212, 0.1)":"rgba(56, 189, 248, 0.15)"}, transparent 40vw),\n      linear-gradient(to bottom, transparent 85%, ${r?"#0f172a":"#f1f5f9"} 100%)\n    `,backgroundBlendMode:"normal"},children:[t.jsx(v,{position:"top-center",toastOptions:{className:"dark:bg-slate-700 dark:text-white",duration:4e3}}),t.jsxs("div",{className:"p-4 sm:p-6 md:p-8 space-y-8",children:[t.jsxs("header",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-6 animate-fade-in border-b border-slate-200 dark:border-slate-700 pb-6",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx(R,{size:44,className:"text-cyan-500"}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-4xl font-bold tracking-tight text-slate-900 dark:text-white",children:"Admin Panel"}),t.jsx("p",{className:"text-slate-500 dark:text-slate-400 mt-1",children:"Oversee orders, transactions, and system templates."})]})]}),t.jsx("nav",{className:"flex items-center gap-2 p-1.5 bg-slate-100 dark:bg-slate-800/60 rounded-xl shadow-inner",children:Object.entries(d).map(([e,{label:s,icon:a}])=>t.jsxs("button",{onClick:()=>n(e),className:(i===e?"bg-white dark:bg-slate-700 text-cyan-600 dark:text-cyan-400 shadow-sm":"text-slate-500 hover:bg-slate-200/50 dark:text-slate-400 dark:hover:bg-slate-700/50")+" flex items-center gap-2.5 whitespace-nowrap px-4 py-2 rounded-lg font-semibold text-sm transition-all",children:[a,t.jsx("span",{children:s})]},e))})]}),t.jsx(a,{mode:"wait",children:t.jsx(l.div,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},exit:{y:-10,opacity:0},transition:{duration:.2},children:d[i].component},i)})]})]})}export{Ze as default};
